<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>butterfly分栏tab</title>
      <link href="/posts/45599b87.html"/>
      <url>/posts/45599b87.html</url>
      
        <content type="html"><![CDATA[<h2 id="butterfly分栏tab"><a href="#butterfly分栏tab" class="headerlink" title="butterfly分栏tab"></a>butterfly分栏tab</h2><div class="tabs" id="分类标签"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分类标签-1">标签语法</button><button type="button" class="tab " data-href="分类标签-2">配置说明</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分类标签-1"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分类标签-2"><ol><li>Unique name :</li></ol><ul><li>选项卡块标签的唯一名称，不带逗号。</li><li>将在#id中用作每个标签及其索引号的前缀。</li><li>如果名称中包含空格，则对于生成#id，所有空格将由破折号代替。</li><li>仅当前帖子&#x2F;页面的URL必须是唯一的！</li></ul><ol start="2"><li>[index]:</li></ol><ul><li>活动选项卡的索引号。</li><li>如果未指定，将选择第一个标签（1）。</li><li>如果index为-1，则不会选择任何选项卡。</li><li>可选参数。</li></ul><ol start="3"><li>[Tab caption]:</li></ol><ul><li>当前选项卡的标题。</li><li>如果未指定标题，则带有制表符索引后缀的唯一名称将用作制表符的标题。</li><li>如果未指定标题，但指定了图标，则标题将为空。</li><li>可选参数。</li></ul><ol start="4"><li>[@icon]:</li></ol><ul><li>FontAwesome图标名称（全名，看起来像“ fas fa-font”）</li><li>可以指定带空格或不带空格；</li><li>例如’Tab caption @icon’ 和 ‘Tab caption@icon’.</li><li>可选参数。</li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> 博客主题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> butterfly </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-bond配置</title>
      <link href="/posts/a9fedf39.html"/>
      <url>/posts/a9fedf39.html</url>
      
        <content type="html"><![CDATA[<h2 id="关闭NetworkManger服务"><a href="#关闭NetworkManger服务" class="headerlink" title="关闭NetworkManger服务"></a>关闭NetworkManger服务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">需要彻底关闭NetworkManger 服务，否则会和bond网卡冲突</span><br><span class="line">systemctl stop NetworkManger.service</span><br><span class="line">systemctl disable NetworkManger.service</span><br></pre></td></tr></table></figure><h2 id="bond-七种模式"><a href="#bond-七种模式" class="headerlink" title="bond 七种模式"></a>bond 七种模式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">1、mode=0(balance-rr)(平衡抡循环策略)</span><br><span class="line">链路负载均衡，增加带宽，支持容错，一条链路故障会自动切换正常链路。交换机需要配置聚合口，思科叫port channel。</span><br><span class="line">特点：传输数据包顺序是依次传输（即：第1个包走eth0，下一个包就走eth1….一直循环下去，直到最后一个传输完毕），此模式提供负载平衡和容错能力；但是我们知道如果一个连接</span><br><span class="line">或者会话的数据包从不同的接口发出的话，中途再经过不同的链路，在客户端很有可能会出现数据包无序到达的问题，而无序到达的数据包需要重新要求被发送，这样网络的吞吐量就会下降</span><br><span class="line"></span><br><span class="line">2、mode=1(active-backup)(主-备份策略)</span><br><span class="line">这个是主备模式，只有一块网卡是active，另一块是备用的standby，所有流量都在active链路上处理，交换机配置的是捆绑的话将不能工作，因为交换机往两块网卡发包，有一半包是丢弃的。</span><br><span class="line">特点：只有一个设备处于活动状态，当一个宕掉另一个马上由备份转换为主设备。mac地址是外部可见得，从外面看来，bond的MAC地址是唯一的，以避免switch(交换机)发生混乱。</span><br><span class="line">此模式只提供了容错能力；由此可见此算法的优点是可以提供高网络连接的可用性，但是它的资源利用率较低，只有一个接口处于工作状态，在有 N 个网络接口的情况下，资源利用率为1/N</span><br><span class="line"></span><br><span class="line">3、mode=2(balance-xor)(平衡策略)</span><br><span class="line">表示XOR Hash负载分担，和交换机的聚合强制不协商方式配合。（需要xmit_hash_policy，需要交换机配置port channel）</span><br><span class="line">特点：基于指定的传输HASH策略传输数据包。缺省的策略是：(源MAC地址 XOR 目标MAC地址) % slave数量。其他的传输策略可以通过xmit_hash_policy选项指定，此模式提供负载平衡和容错能力</span><br><span class="line"></span><br><span class="line">4、mode=3(broadcast)(广播策略)</span><br><span class="line">表示所有包从所有网络接口发出，这个不均衡，只有冗余机制，但过于浪费资源。此模式适用于金融行业，因为他们需要高可靠性的网络，不允许出现任何问题。需要和交换机的聚合强制不协商方式配合。</span><br><span class="line">特点：在每个slave接口上传输每个数据包，此模式提供了容错能力</span><br><span class="line"></span><br><span class="line">5、mode=4(802.3ad)(IEEE 802.3ad 动态链接聚合)</span><br><span class="line">表示支持802.3ad协议，和交换机的聚合LACP方式配合（需要xmit_hash_policy）.标准要求所有设备在聚合操作时，要在同样的速率和双工模式，而且，和除了balance-rr模式外的其它bonding负载均衡模式一样，任何连接都不能使用多于一个接口的带宽。</span><br><span class="line">特点：创建一个聚合组，它们共享同样的速率和双工设定。根据802.3ad规范将多个slave工作在同一个激活的聚合体下。</span><br><span class="line">外出流量的slave选举是基于传输hash策略，该策略可以通过xmit_hash_policy选项从缺省的XOR策略改变到其他策略。需要注意的 是，并不是所有的传输策略都是802.3ad适应的，</span><br><span class="line">尤其考虑到在802.3ad标准43.2.4章节提及的包乱序问题。不同的实现可能会有不同的适应 性。</span><br><span class="line">必要条件：</span><br><span class="line">条件1：ethtool支持获取每个slave的速率和双工设定</span><br><span class="line">条件2：switch(交换机)支持IEEE 802.3ad Dynamic link aggregation</span><br><span class="line">条件3：大多数switch(交换机)需要经过特定配置才能支持802.3ad模式</span><br><span class="line"></span><br><span class="line">6、mode=5(balance-tlb)(适配器传输负载均衡)</span><br><span class="line">是根据每个slave的负载情况选择slave进行发送，接收时使用当前轮到的slave。该模式要求slave接口的网络设备驱动有某种ethtool支持；而且ARP监控不可用。</span><br><span class="line">特点：不需要任何特别的switch(交换机)支持的通道bonding。在每个slave上根据当前的负载（根据速度计算）分配外出流量。如果正在接受数据的slave出故障了，另一个slave接管失败的slave的MAC地址。</span><br><span class="line">必要条件：</span><br><span class="line">ethtool支持获取每个slave的速率</span><br><span class="line"></span><br><span class="line">7、mode=6(balance-alb)(适配器适应性负载均衡)</span><br><span class="line">在5的tlb基础上增加了rlb(接收负载均衡receive load balance).不需要任何switch(交换机)的支持。接收负载均衡是通过ARP协商实现的.</span><br><span class="line">特点：该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡(receive load balance, rlb)，而且不需要任何switch(交换机)的支持。接收负载均衡是通过ARP协商实现的。bonding驱动截获本机发送的ARP应答，并把源硬件地址改写为bond中某个slave的唯一硬件地址，从而使得不同的对端使用不同的硬件地址进行通信。</span><br><span class="line">来自服务器端的接收流量也会被均衡。当本机发送ARP请求时，bonding驱动把对端的IP信息从ARP包中复制并保存下来。当ARP应答从对端到达 时，bonding驱动把它的硬件地址提取出来，并发起一个ARP应答给bond中的某个slave。</span><br><span class="line">使用ARP协商进行负载均衡的一个问题是：每次广播 ARP请求时都会使用bond的硬件地址，因此对端学习到这个硬件地址后，接收流量将会全部流向当前的slave。这个问题可以通过给所有的对端发送更新 （ARP应答）来解决，应答中包含他们独一无二的硬件地址，从而导致流量重新分布。</span><br><span class="line">当新的slave加入到bond中时，或者某个未激活的slave重新 激活时，接收流量也要重新分布。接收的负载被顺序地分布（round robin）在bond中最高速的slave上</span><br><span class="line">当某个链路被重新接上，或者一个新的slave加入到bond中，接收流量在所有当前激活的slave中全部重新分配，通过使用指定的MAC地址给每个 client发起ARP应答。下面介绍的updelay参数必须被设置为某个大于等于switch(交换机)转发延时的值，从而保证发往对端的ARP应答 不会被switch(交换机)阻截。</span><br><span class="line">必要条件：</span><br><span class="line">条件1：ethtool支持获取每个slave的速率；</span><br><span class="line">条件2：底层驱动支持设置某个设备的硬件地址，从而使得总是有个slave(curr_active_slave)使用bond的硬件地址，同时保证每个bond 中的slave都有一个唯一的硬件地址。如果curr_active_slave出故障，它的硬件地址将会被新选出来的 curr_active_slave接管</span><br><span class="line">其实mod=6与mod=0的区别：mod=6，先把eth0流量占满，再占eth1，….ethX；而mod=0的话，会发现2个口的流量都很稳定，基本一样的带宽。而mod=6，会发现第一个口流量很高，第2个口只占了小部分流量。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">mode5和mode6不需要交换机端的设置，网卡能自动聚合。mode4需要支持802.3ad。mode0，mode2和mode3理论上需要静态聚合方式。</span><br><span class="line">但实测中mode0可以通过mac地址欺骗的方式在交换机不设置的情况下不太均衡地进行接收。</span><br></pre></td></tr></table></figure><h2 id="接口配置"><a href="#接口配置" class="headerlink" title="接口配置"></a>接口配置</h2><p>这里我们将ens224和ens256 绑定为一个bond接口，bond接口ID 为0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">ens224配置</span><br><span class="line">[root@lean network-scripts]# cat /etc/sysconfig/network-scripts/ifcfg-ens224 </span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none //网卡协议</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens224</span><br><span class="line">DEVICE=ens224</span><br><span class="line">ONBOOT=yes</span><br><span class="line">MASTER=bond0 //所属的bond接口</span><br><span class="line">SLAVE=yes //slave功能</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ens256配置</span><br><span class="line">[root@lean network-scripts]# cat /etc/sysconfig/network-scripts/ifcfg-ens256</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none //网卡协议</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens256</span><br><span class="line">DEVICE=ens256</span><br><span class="line">ONBOOT=yes</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如没有ifcfg-bond0 文件直接新建就可以了，内容就复制已有端口的配置内容即可，记得修改相关内容，比如 name名称 device 名称 mac地址信息等等</span><br><span class="line"></span><br><span class="line">[root@lean network-scripts]# cat /etc/sysconfig/network-scripts/ifcfg-bond0 </span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=dhcp //开启DHCP</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=bond0</span><br><span class="line">DEVICE=bond0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BONDING_OPTS=&quot;mode=0 miimon=50&quot; </span><br><span class="line"></span><br><span class="line">miimon 是链路监测的时间间隔单位是毫秒，miimon=50的意思就是，每50毫秒检测网卡和交换机之间是否连通，如不通则使用另外的链路。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">添加驱动支持</span><br><span class="line">[root@lean network-scripts]# cat /etc/modprobe.d/bonding.conf </span><br><span class="line">alias bond0 bonding</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">重启网卡</span><br><span class="line">ifdown ens224 &amp;&amp; ifup ens224</span><br><span class="line">ifdown ens256 &amp;&amp; ifup ens256</span><br><span class="line">ifup bond0</span><br><span class="line"></span><br><span class="line">查看端口信息</span><br><span class="line">ifconfig bond0</span><br><span class="line">ifconfig ens224</span><br><span class="line">ifconfig ens256</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="查看bond使用了哪些物理接口"><a href="#查看bond使用了哪些物理接口" class="headerlink" title="查看bond使用了哪些物理接口"></a>查看bond使用了哪些物理接口</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">此命令同样可以查看物理接口真实MAC地址信息；因为一旦绑定了bond，ifconfig查看接口的MAC地址被同化为了bond的mac地址</span><br><span class="line">[root@lean ~]# cat /proc/net/bonding/bond0 </span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: load balancing (round-robin)</span><br><span class="line"> //bond0工作模式为负载均衡</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens224</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:50:56:b2:1f:da</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens256</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:50:56:b2:36:5c</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###多band 多负载</span><br><span class="line"></span><br><span class="line">[root@lean ~]# cat /proc/net/bonding/bond1</span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: fault-tolerance (active-backup) //bond1 工作模式为主备</span><br><span class="line">Primary Slave: None</span><br><span class="line">Currently Active Slave: ens192</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens192</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:50:56:b2:61:f2</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens193</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:50:56:b2:a2:92</span><br></pre></td></tr></table></figure><h2 id="网络接口细节信息"><a href="#网络接口细节信息" class="headerlink" title="网络接口细节信息"></a>网络接口细节信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">物理接口信息和bond接口MAC地址一致，而且物理接口信息状态多了SLAVE标识</span><br><span class="line">### bond0 接口</span><br><span class="line">[root@lean ~]# ifconfig bond0</span><br><span class="line">bond0: flags=5187&lt;UP,BROADCAST,RUNNING,MASTER,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.16.254.69  netmask 255.255.255.0  broadcast 172.16.254.255</span><br><span class="line">        ether 00:50:56:b2:1f:da  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">### ens224 接口</span><br><span class="line">ens224: flags=6211&lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST&gt;  mtu 1500</span><br><span class="line">        ether 00:50:56:b2:1f:da  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">ens256: flags=6211&lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST&gt;  mtu 1500</span><br><span class="line">        ether 00:50:56:b2:1f:da  txqueuelen 1000  (Ethernet)</span><br></pre></td></tr></table></figure><h2 id="多bond不同工作模式配置-拓展"><a href="#多bond不同工作模式配置-拓展" class="headerlink" title="多bond不同工作模式配置-拓展"></a>多bond不同工作模式配置-拓展</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">bond基础配置不在赘述，只展示需要注意的点</span><br><span class="line"></span><br><span class="line">1. bond配置文件模式</span><br><span class="line">[root@lean ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=dhcp</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=bond0</span><br><span class="line">DEVICE=bond0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BONDING_OPTS=&quot;mode=0 mllmon=50&quot;  //mode=0 负载均衡模式</span><br><span class="line">[root@lean ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=dhcp</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=bond1</span><br><span class="line">DEVICE=bond1</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BONDING_OPTS=&quot;mode=1 miimon=100&quot; //mode=1 主备模式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. 驱动文件配置</span><br><span class="line"></span><br><span class="line">因为有两个bond，配置文件应指定bond0 bond1的驱动模块</span><br><span class="line">[root@lean ~]# cat /etc/modprobe.d/bonding.conf </span><br><span class="line">alias bond0 bonding </span><br><span class="line">alias bond1 bonding</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> boud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cisco-AIR-AP1852I-H-K9掉线</title>
      <link href="/posts/924a3526.html"/>
      <url>/posts/924a3526.html</url>
      
        <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>AP突然掉线，通过console提示以下报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">启动时报错信息：</span><br><span class="line">error: open /dev/board-config</span><br><span class="line"></span><br><span class="line">启动后可正常获取地址，并可以发现控制器，提示以下报错</span><br><span class="line">[*03/21/2023 20:16:07.6024] CAPWAP State: Discovery</span><br><span class="line">[*03/21/2023 20:16:07.6024] Discovery Request sent to 255.255.255.255, discovery type UNKNOWN(0)</span><br><span class="line">[*03/21/2023 20:16:07.6024] Discovery Response from 10.128.253.253</span><br><span class="line">[*03/21/2023 20:16:07.6024] Discovery response from MWAR &#x27;&#x27;running version 0.0.0.0 is rejected.</span><br><span class="line">[*03/21/2023 20:16:07.6024] Failed to decode discovery response(status = 4).</span><br><span class="line">[*03/21/2023 20:16:07.6024] CAPWAP SM handler: Failed to process message type 2 state 2.</span><br><span class="line">[*03/21/2023 20:16:07.6024] Failed to handle capwap control message from controller - status 4</span><br><span class="line">[*03/21/2023 20:16:07.6024] Failed to process unencrypted capwap packet 0x132c000 from 10.128.253.253</span><br><span class="line">[*03/21/2023 20:16:07.6024] Failed to send message to CAPWAP state machine, msgId 0</span><br><span class="line">[*03/21/2023 20:16:07.6024] Failed to send capwap message 0 to the state machine. Packet already freed.</span><br><span class="line">[*03/21/2023 20:16:07.6024] IPv4 wtpProcessPacketFromSocket returned 4</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>非官方消息：AP芯片故障原因<br>直接换新</p>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> 无线 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>上传镜像文件到思科设备</title>
      <link href="/posts/540b0a09.html"/>
      <url>/posts/540b0a09.html</url>
      
        <content type="html"><![CDATA[<h2 id="电脑开启FTP-SFTP服务"><a href="#电脑开启FTP-SFTP服务" class="headerlink" title="电脑开启FTP&#x2F;SFTP服务"></a>电脑开启FTP&#x2F;SFTP服务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">windows下载3CDaemon软件并开启FTP/SFTP服务</span><br><span class="line">下载安装及配置方式自行百度</span><br><span class="line">FTP模式 速度快</span><br><span class="line">SFTP模式速度慢</span><br><span class="line">常规流程为：下载安装软件，启动软件，配置默认上传下载目录，配置用户名密码(SFTP不需要)</span><br></pre></td></tr></table></figure><h2 id="将镜像上传到思科设备"><a href="#将镜像上传到思科设备" class="headerlink" title="将镜像上传到思科设备"></a>将镜像上传到思科设备</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">将下载好的镜像，放置在3CDaemon设置好的默认路径中</span><br><span class="line">在交换机中执行</span><br><span class="line">copy ftp://admin:123456@10.1.1.1/ciscoswios.bin bootflash:/</span><br><span class="line">其中： admin=用户名 123456=密码 10.1.1.1=表示3CDaemon服务器地址 </span><br><span class="line">ciscoswios.bin=你实际下载的镜像名称(必须带后缀) bootflash= 拷贝到交换机的存储名称</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> 思科 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>天融信防火墙 vpn抓包</title>
      <link href="/posts/9557093.html"/>
      <url>/posts/9557093.html</url>
      
        <content type="html"><![CDATA[<h2 id="抓包示例"><a href="#抓包示例" class="headerlink" title="抓包示例"></a>抓包示例</h2><h3 id="抓包命令的格式以及使用方法："><a href="#抓包命令的格式以及使用方法：" class="headerlink" title="抓包命令的格式以及使用方法："></a>抓包命令的格式以及使用方法：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">System tcpdump –ni any 后续可以添加具体的ip（host）、端口（port）、应用层协议（tcp、udp）和逻辑关系（and、or）。</span><br><span class="line"></span><br><span class="line">常用参数说明：</span><br><span class="line">-n，不进行ip地址到主机名称的转换。</span><br><span class="line">-i，需要监听的接口。（any为所有接口）</span><br><span class="line">-e，显示数据包的2层信息。</span><br><span class="line">-vvv，输出详细的内容。（v的个数没有限制）</span><br><span class="line">-xxx，输出包头内容。（x的个数没有限制）</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="抓包范例与说明："><a href="#抓包范例与说明：" class="headerlink" title="抓包范例与说明："></a>抓包范例与说明：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">监听所有接口抓取与192.168.7.168相关的数据包，如下：</span><br><span class="line">system tcpdump -ni any host 192.168.7.168</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 防火墙 </tag>
            
            <tag> ipsec </tag>
            
            <tag> vpn </tag>
            
            <tag> 天融信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>H3C AP胖转瘦方法</title>
      <link href="/posts/1fe7781e.html"/>
      <url>/posts/1fe7781e.html</url>
      
        <content type="html"><![CDATA[<h2 id="方法一：console线转"><a href="#方法一：console线转" class="headerlink" title="方法一：console线转"></a>方法一：console线转</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">console连接AP console口.</span><br><span class="line">用户模式下</span><br><span class="line">&lt;H3C&gt; ap-mode fit</span><br><span class="line">&lt;H3C&gt;y</span><br><span class="line">&lt;H3C&gt;y</span><br><span class="line">会出点很多省略号，等到自动重启后就是瘦模式了。</span><br><span class="line"></span><br><span class="line">AP默认登录密码： h3capadmin</span><br></pre></td></tr></table></figure><h2 id="方法二：Telnet方式"><a href="#方法二：Telnet方式" class="headerlink" title="方法二：Telnet方式"></a>方法二：Telnet方式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">（适用于没有console口的AP，如面板的）</span><br><span class="line"></span><br><span class="line">AP默认地址是192.168.0.50 用户名admin 密码h3capadmin 默认胖AP的无线名称是H3C.</span><br><span class="line">无线网卡配上192.168.0.2地址 连接H3C无线.</span><br><span class="line">开始-运行-CMD telnet到192.168.0.50输入用户名密码登录</span><br><span class="line">&lt;H3C&gt; ap-mode fit</span><br><span class="line">&lt;H3C&gt;y</span><br><span class="line">&lt;H3C&gt;y</span><br></pre></td></tr></table></figure><h2 id="方法三：web方式"><a href="#方法三：web方式" class="headerlink" title="方法三：web方式"></a>方法三：web方式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AP默认地址是192.168.0.50 用户名admin 密码h3capadmin 默认胖AP的无线名称是H3C.</span><br><span class="line">无线网卡配上192.168.0.2地址 连接H3C无线.</span><br><span class="line">浏览器登录192.168.0.50 建议用IE、谷歌、火狐浏览器.</span><br><span class="line">找到高级设置-形态切换-切换-保存。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 无线 </tag>
            
            <tag> h3c </tag>
            
            <tag> 华三 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos7安装RadiusManager认证系统</title>
      <link href="/posts/50f78af.html"/>
      <url>/posts/50f78af.html</url>
      
        <content type="html"><![CDATA[<h2 id="直接搬运，懒得翻译了"><a href="#直接搬运，懒得翻译了" class="headerlink" title="直接搬运，懒得翻译了"></a>直接搬运，懒得翻译了</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line">                                              DMA Softlab in CentOS</span><br><span class="line">=================== How to Install DMA Softlab in CentOS 64bit========================</span><br><span class="line"></span><br><span class="line">=================== Download Links. Use the following links to download ==============</span><br><span class="line"></span><br><span class="line">http://mirrors.ges.net.pk/centos/7/isos/x86_64/</span><br><span class="line">http://mirrors.ges.net.pk/centos/7/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso</span><br><span class="line"></span><br><span class="line">=================== MAC Address for DMA ==============================================    </span><br><span class="line"></span><br><span class="line">RadiusManager 4.1.6 MAC Addr = 00:00:5A:74:FD:29</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=================== How to Chek the Current IP Address ================================</span><br><span class="line">ip addr</span><br><span class="line"></span><br><span class="line">=================== Step  - 1 &gt;Disabling Firewall =====================================</span><br><span class="line"></span><br><span class="line">yum install update</span><br><span class="line">yum -y install nano</span><br><span class="line">yum install iptables-services</span><br><span class="line">systemctl stop iptables</span><br><span class="line">chkconfig iptables off</span><br><span class="line"></span><br><span class="line">nano /etc/selinux/config</span><br><span class="line"></span><br><span class="line">SELINUX=enforcing        change to   SELINUX=disabled</span><br><span class="line"></span><br><span class="line">    Ctrl+x y Enter</span><br><span class="line">    Save &amp; Exit </span><br><span class="line"></span><br><span class="line">systemctl status firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">=================== Step  - 2 Installing=====================================</span><br><span class="line"></span><br><span class="line">rpm -ivh https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-14.noarch.rpm</span><br><span class="line">yum install mc wget crontabs make gcc libtool-ltdl curl mysql-devel net-snmp net-snmp-utils php php-mysql php-gd php-snmp php-process ntp sendmail sendmail-cf alpine mutt mariadb-server mariadb php-mcrypt cronie wget phpmyadmin net-tools psmisc</span><br><span class="line"></span><br><span class="line">1#-Is this ok [y/d/N]: y  ENTER</span><br><span class="line">2#-Is this ok [y/N]: y  ENTER</span><br><span class="line"></span><br><span class="line">  #- http://192.168.10.108/phpmyadmin</span><br><span class="line"></span><br><span class="line">yum -y install glibc.i686 libgcc_s.so.1</span><br><span class="line">systemctl start mariadb.service</span><br><span class="line">systemctl enable mariadb.service</span><br><span class="line"></span><br><span class="line">=================== Step - 3 &gt; Config Mysql =====================================</span><br><span class="line"></span><br><span class="line">#Make sure to setup mysql root password</span><br><span class="line"></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line">                    &quot;Follow Steps&quot;</span><br><span class="line">1#-Enter current password for root (enter for none):  ENTER</span><br><span class="line">2#-Set root password? [Y/n] y  ENTER</span><br><span class="line">3#-New password:xxxxxx    Type Strong Password than press ENTER</span><br><span class="line">4#-Re-enter new password:xxxxxx    Re-Type Password ENTER</span><br><span class="line">5#-Remove anonymous users? [Y/n] y     ENTER</span><br><span class="line">6#-Disallow root login remotely? [Y/n] n     ENTER</span><br><span class="line">7#-Remove test database and access to it? [Y/n] y     ENTER</span><br><span class="line">8#-Reload privilege tables now? [Y/n] y     ENTER</span><br><span class="line"></span><br><span class="line">systemctl start httpd.service</span><br><span class="line">systemctl enable httpd.service</span><br><span class="line"></span><br><span class="line">=================== Step  - 4 &gt; Adding IONCUBE module in PHP =====================================</span><br><span class="line"></span><br><span class="line">wget http://downloads3.ioncube.com/loader_downloads/ioncube_loaders_lin_x86-64.tar.gz</span><br><span class="line">tar -xvzf ioncube_loaders_lin_x86-64.tar.gz</span><br><span class="line">cd ioncube</span><br><span class="line">mv ioncube_loader_lin_5.4.so /usr/lib64/php/modules/</span><br><span class="line">chmod 777 /usr/lib64/php/modules/ioncube_loader_lin_5.4.so</span><br><span class="line"></span><br><span class="line">-------------------------------------</span><br><span class="line">nano /etc/php.ini</span><br><span class="line"></span><br><span class="line">#-php.ini &gt; add this line </span><br><span class="line"></span><br><span class="line">zend_extension = /usr/lib64/php/modules/ioncube_loader_lin_5.4.so</span><br><span class="line"></span><br><span class="line">    &gt;following line after [PHP] heading, usually this heading is in first line.</span><br><span class="line"></span><br><span class="line">    Ctrl+x y Enter</span><br><span class="line">    Save &amp; Exit</span><br><span class="line">-------------------------------------</span><br><span class="line"></span><br><span class="line">systemctl restart httpd.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">php -v</span><br><span class="line">             &gt; check php version</span><br><span class="line"></span><br><span class="line">                   Version</span><br><span class="line">     ___________________________________________________________________________________________________</span><br><span class="line">    |                                                                                                   |</span><br><span class="line">    |   PHP 5.4.16 (cli) (built: Apr  1 2020 04:07:17)                                                  |</span><br><span class="line">    |   Copyright (c) 1997-2013 The PHP Group                                                           |</span><br><span class="line">    |   Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies                                   |</span><br><span class="line">    |       with the ionCube PHP Loader + ionCube24 v11.0.1, Copyright (c) 2002-2022, by ionCube Ltd.   |</span><br><span class="line">    |___________________________________________________________________________________________________|</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">cd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=================== Step  - 5 Download FreeRadius in &gt; root &gt; Temp folder=====================================</span><br><span class="line"></span><br><span class="line">mkdir temp</span><br><span class="line"></span><br><span class="line">cd temp</span><br><span class="line"></span><br><span class="line">wget http://www.dmasoftlab.com/download/freeradius-server-2.2.0-dma-patch-2.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xvzf freeradius-server-2.2.0-dma-patch-2.tar.gz</span><br><span class="line"></span><br><span class="line">cd freeradius-server-2.2.0</span><br><span class="line"></span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">radiusd -X</span><br><span class="line"></span><br><span class="line">      EXIT</span><br><span class="line">CTRL+C</span><br><span class="line"></span><br><span class="line">   &gt;  press CTRL+C to return to command prompt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">cd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=================== STEP  - 6 Create Database in Mysql=====================================</span><br><span class="line"></span><br><span class="line">mysql -u root -p</span><br><span class="line">          &quot;YOURMYSQLPASS&quot;</span><br><span class="line">          &quot;Copy and paste all commands&quot;</span><br><span class="line">CREATE DATABASE radius;</span><br><span class="line">CREATE DATABASE conntrack;</span><br><span class="line">CREATE USER &#x27;radius&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;radius123&#x27;;</span><br><span class="line">CREATE USER &#x27;conntrack&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;conn123&#x27;;</span><br><span class="line">GRANT ALL ON radius.* TO radius@localhost;</span><br><span class="line">GRANT ALL ON conntrack.* TO conntrack@localhost;</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">=================== Step  - 7 &gt;Download &amp; Install RADIUS MANAGER 4.1.6 =====================================</span><br><span class="line"></span><br><span class="line">cd temp</span><br><span class="line"></span><br><span class="line"># - Download the file with attachments, filename &quot; radiusmanager-4.1.6.gz &quot;</span><br><span class="line"># - Copy the file to the following address &quot; root ... /temp &quot;</span><br><span class="line"># - by a program WinSCP</span><br><span class="line"></span><br><span class="line">tar zxvf radiusmanager-4.1.6.gz</span><br><span class="line"></span><br><span class="line">cd radiusmanager-4.1.6</span><br><span class="line"></span><br><span class="line">chmod 755 install.sh</span><br><span class="line"></span><br><span class="line">#####Now start the Radius Install Script.</span><br><span class="line"></span><br><span class="line">./install.sh</span><br><span class="line"></span><br><span class="line">#-1</span><br><span class="line">Select the type of your operating system:</span><br><span class="line">1. Redhat (CentOS, Fedora Core)</span><br><span class="line">2. Debian (Ubuntu, Debian)</span><br><span class="line">Sellect = 1 </span><br><span class="line">  Choose an option: [1]1     Press Enter</span><br><span class="line"></span><br><span class="line">#-2</span><br><span class="line">Select installation type:</span><br><span class="line">1. New installation</span><br><span class="line">2. Upgrade</span><br><span class="line"> New installation Select 1 </span><br><span class="line">Choose an option: [1]1     Press Enter</span><br><span class="line">#-3</span><br><span class="line"></span><br><span class="line">#-1  WWW root path: [/var/www/html]     Press Enter</span><br><span class="line">#-2  RADIUS database host: [localhost]     Press Enter</span><br><span class="line">#-3  RADIUS database username: [radius]    Press Enter</span><br><span class="line">#-4  RADIUS database password: [radius123]     Press Enter</span><br><span class="line">#-5  CTS database host: [localhost]     Press Enter</span><br><span class="line">#-6  CTS database username: [conntrack]     Press Enter</span><br><span class="line">#-7  CTS database password: [conn123]     Press Enter</span><br><span class="line">#-8  Freeradius UNIX user: [root]     Press Enter</span><br><span class="line">#-9  HTTPD UNIX user: [apache]     Press Enter</span><br><span class="line">#-10 Create rmpoller service: [y] y     Press Enter</span><br><span class="line">#-11 Create rmconntrack service: [y] y     Press Enter</span><br><span class="line">#-12 Back up RADIUS database: [y] y Press Enter</span><br><span class="line">#-13 Are You sure to begin the installation? [n] y    Press Enter</span><br><span class="line"></span><br><span class="line">            -------------------------------------</span><br><span class="line"></span><br><span class="line">systemctl restart httpd.service</span><br><span class="line"></span><br><span class="line">systemctl restart mariadb.service</span><br><span class="line"></span><br><span class="line">systemctl restart radiusd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Copy Radius from var/www/html paste in var/www/</span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://yourip/radiusmanager/admin.php</span><br><span class="line"></span><br><span class="line">=================== Access DMA ========================================================</span><br><span class="line">http://192.168.10.111/radiusmanager/admin.php</span><br><span class="line">ID = admin</span><br><span class="line">Password = 1111</span><br><span class="line">=======================================================================================</span><br></pre></td></tr></table></figure><h2 id="web程序更改为Nginx"><a href="#web程序更改为Nginx" class="headerlink" title="web程序更改为Nginx"></a>web程序更改为Nginx</h2><p>以下为我的nginx配置，因为DMA4.1.6貌似不允许配置https，所以用ngxin来转发一下(apache不会用)<br>如果你有更好的方式，请分享</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       [::]:80;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /var/www/radiusmanager;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">            fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">            fastcgi_index  index.php;</span><br><span class="line">            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">            include        fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">#####################https configuretion ##################</span><br><span class="line">     server &#123;</span><br><span class="line">         listen       443 ssl http2;</span><br><span class="line">         listen       [::]:443 ssl http2;</span><br><span class="line">         server_name  _;</span><br><span class="line">         root         /var/www/radiusmanager;</span><br><span class="line"> </span><br><span class="line">         ssl_certificate &quot;/var/www/radiusmanager/certs/server.crt&quot;;</span><br><span class="line">         ssl_certificate_key &quot;/var/www/radiusmanager/certs/server.key&quot;;</span><br><span class="line">         ssl_session_cache shared:SSL:1m;</span><br><span class="line">         ssl_session_timeout  10m;</span><br><span class="line">         ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">         ssl_prefer_server_ciphers on;</span><br><span class="line"> </span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">         include /etc/nginx/default.d/*.conf;</span><br><span class="line"> </span><br><span class="line">         error_page 404 /404.html;</span><br><span class="line">             location = /40x.html &#123;</span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line">         error_page 500 502 503 504 /50x.html;</span><br><span class="line">             location = /50x.html &#123;</span><br><span class="line">         &#125;</span><br><span class="line">#        location ~ \.php$ &#123;</span><br><span class="line">#            fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">#            fastcgi_index  index.php;</span><br><span class="line">#            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">#            include        fastcgi_params;</span><br><span class="line">#        &#125;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://127.0.0.1;</span><br><span class="line">&#125;</span><br><span class="line">        location ~ .* &#123;</span><br><span class="line">                        proxy_pass http://127.0.0.1;</span><br><span class="line">                        proxy_set_header Host $http_host;</span><br><span class="line">                        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">                        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"># Settings for a TLS enabled server.</span><br><span class="line">#</span><br><span class="line">#    server &#123;</span><br><span class="line">#        listen       443 ssl http2;</span><br><span class="line">#        listen       [::]:443 ssl http2;</span><br><span class="line">#        server_name  _;</span><br><span class="line">#        root         /usr/share/nginx/html;</span><br><span class="line">#</span><br><span class="line">#        ssl_certificate &quot;/etc/pki/nginx/server.crt&quot;;</span><br><span class="line">#        ssl_certificate_key &quot;/etc/pki/nginx/private/server.key&quot;;</span><br><span class="line">#        ssl_session_cache shared:SSL:1m;</span><br><span class="line">#        ssl_session_timeout  10m;</span><br><span class="line">#        ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">#        ssl_prefer_server_ciphers on;</span><br><span class="line">#</span><br><span class="line">#        # Load configuration files for the default server block.</span><br><span class="line">#        include /etc/nginx/default.d/*.conf;</span><br><span class="line">#</span><br><span class="line">#        error_page 404 /404.html;</span><br><span class="line">#            location = /40x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#</span><br><span class="line">#        error_page 500 502 503 504 /50x.html;</span><br><span class="line">#            location = /50x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> radius </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos7使用postfix实现Gmail邮件转发</title>
      <link href="/posts/46f48532.html"/>
      <url>/posts/46f48532.html</url>
      
        <content type="html"><![CDATA[<h2 id="Gmail开启SMTP功能"><a href="#Gmail开启SMTP功能" class="headerlink" title="Gmail开启SMTP功能"></a>Gmail开启SMTP功能</h2><p>方式自行百度，此处不展示</p><h2 id="安装postfix"><a href="#安装postfix" class="headerlink" title="安装postfix"></a>安装postfix</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install postfix cyrus-sasl-sql cyrus-sasl-plain cyrus-sasl-lib mailx</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置main-cf文件"><a href="#配置main-cf文件" class="headerlink" title="配置main.cf文件"></a>配置main.cf文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/postfix/main.cf //编辑main.cf文件</span><br><span class="line">底部添加以下内容</span><br><span class="line"></span><br><span class="line">relayhost = [smtp.gmail.com]:587</span><br><span class="line">smtp_sasl_auth_enable = yes</span><br><span class="line">smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd</span><br><span class="line">smtp_sasl_security_options = noanonymous</span><br><span class="line">smtp_sasl_tls_security_options = noanonymous</span><br><span class="line">smtp_tls_security_level = may</span><br></pre></td></tr></table></figure><h2 id="新建邮箱认证配置文件"><a href="#新建邮箱认证配置文件" class="headerlink" title="新建邮箱认证配置文件"></a>新建邮箱认证配置文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/postfix/sasl_passwd</span><br><span class="line">并添加以下内容</span><br><span class="line">[smtp.gmail.com]:587 testss@gmail.com:wixhljacufesesws</span><br><span class="line"></span><br><span class="line">前半段为smtp服务器地址及端口，后半部分为你的邮箱地址及密码(SMTP授权码)</span><br><span class="line"></span><br><span class="line">修复权限并更新 postfix 配置以使用 sasl_passwd 文件：</span><br><span class="line"></span><br><span class="line">chmod 400 /etc/postfix/sasl_passwd </span><br><span class="line">postmap /etc/postfix/sasl_passwd</span><br><span class="line"></span><br><span class="line">重启postfix saslauthd</span><br><span class="line">systemctl restart postfix</span><br><span class="line">systemctl restart saslauthd</span><br></pre></td></tr></table></figure><h2 id="邮件测试"><a href="#邮件测试" class="headerlink" title="邮件测试"></a>邮件测试</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Test mail from postfix&quot; | mail -s &quot;Test Postfix&quot; 73884@qq.com</span><br><span class="line"></span><br><span class="line">此时你可以收到一封</span><br><span class="line">主题为 Test Postifx；内容为 Test mail from postfix 的邮件</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> postfix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos7安装webmin</title>
      <link href="/posts/4c082866.html"/>
      <url>/posts/4c082866.html</url>
      
        <content type="html"><![CDATA[<p>打开您选择的编辑器并创建以下存储库文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/yum.repos.d/webmin.repo</span><br></pre></td></tr></table></figure><p>将以下内容粘贴到文件中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/webmin.repo</span><br><span class="line"></span><br><span class="line">添加以下内容</span><br><span class="line">[Webmin]</span><br><span class="line">name=Webmin Distribution Neutral</span><br><span class="line">#baseurl=https://download.webmin.com/download/yum</span><br><span class="line">mirrorlist=https://download.webmin.com/download/yum/mirrorlist</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">保存并关闭</span><br></pre></td></tr></table></figure><p>接下来，使用以下命令导入Webmin GPG密钥：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm --import http://www.webmin.com/jcameron-key.asc</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>键入以下内容以获取Webmin的最新版本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install webmin</span><br></pre></td></tr></table></figure><p>所有依赖关系将自动解决。安装完成后，将显示以下输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Webmin install complete. You can now login to https://your_server_ip_or_hostname:10000/</span><br><span class="line">as root with your root password.</span><br></pre></td></tr></table></figure><p>Webmin服务将自动启动。</p><p>就是这样！至此，您已经在CentOS 7服务器上成功安装了Webmin。</p><p>webmin默认监听10000断口，请确认防火墙已允许10000端口，否则无法访问</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华为无线WLAN配置</title>
      <link href="/posts/4aaecdb.html"/>
      <url>/posts/4aaecdb.html</url>
      
        <content type="html"><![CDATA[<h2 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">规划管理vlan 、业务vlan 、APwlan</span><br><span class="line">1. 配置好交换机基本信息</span><br><span class="line">2. 配置DHCP FOR_AP DHCP FOR_ST</span><br><span class="line">3. AC配置vlan，管理地址，接口信息，</span><br><span class="line">4. AP上线需要在AC上配置   国家码CN(默认模版)  AP认证方式(默认为MAC认证)，配置AC的源接口(AC管理地址或管理VLAN)   ----------------- 此时正常情况下，已经可以看到AP上线</span><br><span class="line">5. 新增ssid业务</span><br><span class="line"> 5.1 SSID 模版  ssid-profile name XXX</span><br><span class="line"> 5.2 安全模版 security-profile name XXX    (认证方式)</span><br><span class="line"> 5.3 VAP模版 vap-profile name XXX</span><br><span class="line">  5.3.1 转发方式 (集中转发 本地转发)</span><br><span class="line">  5.3.2 绑定SSID模版</span><br><span class="line">  5.3.3 绑定安全模版</span><br><span class="line">  5.3.4 配置业务vlan   </span><br><span class="line">    A: service-vlan vlan-id vlan-id（1-4094）此处表示业务VLAN 10 </span><br><span class="line">    B: service-vlan vlan-pool  vlan组名    此处表示可绑定多个业务vlan，要提前定义vlan-pool </span><br><span class="line">6. 配置AP-Group1</span><br><span class="line"> 6.1 新建AP组，并绑定VAP模版至wlan1 radio 0/1     0表示2.4G 1表示5G</span><br><span class="line"> 6.2 调整AP所属组    *****通过AP ID方式</span><br><span class="line">   6.2.1 AP ID 可通过dia ap all 查看</span><br><span class="line">   6.2.2 ap-regroup ap-id 1 new-group AP-Group1   表示将ID为1 的ap加入到AP-Group1组</span><br><span class="line"> 6.3 调整AP所属组    *****通过AP name方式</span><br><span class="line">   6.3.1 通过AP ID方式重命名AP name</span><br><span class="line">     ap-rename ap-id 1 new-name 13F_AP1   表示将ID为1 的AP重命名为13F_AP1</span><br><span class="line">   6.3.2 ap-regroup ap-name 13F_AP1 new-group AP-Group1 表示将名字为13F_AP1的AP-Group1组 </span><br></pre></td></tr></table></figure><h2 id="二层组网"><a href="#二层组网" class="headerlink" title="二层组网"></a>二层组网</h2><p><a href="https://img.ksdn.org/i/2024/08/25/66cb4bb1f3167.png"></a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">实验详情</span><br><span class="line">需求：</span><br><span class="line">1. 用户使用密码认证上线 ，共计2个SSID</span><br><span class="line">2. 管理vlan100 网关192.168.100.254</span><br><span class="line">3. 业务vlan101 网关192.168.101.254</span><br><span class="line">4. 本地转发</span><br><span class="line"></span><br><span class="line">交换机配置:</span><br><span class="line"> ==================</span><br><span class="line">vlan batch 100 101</span><br><span class="line">int vlan 100</span><br><span class="line">ip add 192.168.100.254 24</span><br><span class="line">dhcp select global</span><br><span class="line">undo shutdown</span><br><span class="line">int vlan 101</span><br><span class="line">ip add 192.168.101.254 24</span><br><span class="line">dhcp select global</span><br><span class="line">undo shutdown</span><br><span class="line"> ===================</span><br><span class="line">DHCP配置</span><br><span class="line">dhcp enable</span><br><span class="line">ip pool vlan100</span><br><span class="line">network 192.168.100.0 mask 24</span><br><span class="line">gateway 192.168.100.254</span><br><span class="line">ip pool vlan101</span><br><span class="line">network 192.168.101.254 mask 24</span><br><span class="line">gateway-list 192.168.101.254</span><br><span class="line"> ====================</span><br><span class="line">端口配置</span><br><span class="line">int g0/0/1</span><br><span class="line">port lint-type trunk</span><br><span class="line">port trunk allow-pass vlan all</span><br><span class="line">int g0/0/2 </span><br><span class="line">port link-type trunk</span><br><span class="line">port trunk pvid vlan 100</span><br><span class="line">port trunk allow-pass vlan all</span><br><span class="line">int g0/0/3</span><br><span class="line">port link-type trunk</span><br><span class="line">port trunk pvid vlan 100</span><br><span class="line">port trunk allow-pass vlan all</span><br><span class="line">int g0/0/4</span><br><span class="line">port link-type trunk</span><br><span class="line">port trunk pvid vlan 100</span><br><span class="line">port trunk allow-pass vlan all</span><br><span class="line"></span><br><span class="line">=========此时，设备网络互连配置完成，接下来配置AC基本配置</span><br><span class="line">[AC]</span><br><span class="line">配置域管理模板</span><br><span class="line">wlan</span><br><span class="line"> regulatory-domain-profile name default     //主要配置国家码，可以使用默认模板，通用</span><br><span class="line">  country-code CN </span><br><span class="line">  quit</span><br><span class="line"> ap auth-mode no-auth         //表示AP的认证方式为不需要认证</span><br><span class="line"></span><br><span class="line"> ap-group name default</span><br><span class="line">  regulatory-domain-profile default          //在AP组下引用域管理模板。default为域管理模板名称</span><br><span class="line">     ------------------</span><br><span class="line"> capwap source interface vlanif 100</span><br><span class="line"> 或者</span><br><span class="line"> capwap source ip-address 192.168.100.254  </span><br><span class="line">     --------------------------配置AC的源接口 以上2种方式任选一种</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">   =========此时AP可自动上线    可通过dis ap all查看</span><br><span class="line">配置SSID模板</span><br><span class="line">wlan</span><br><span class="line"> ssid-profile name ssid_comlan              //ssid-comlan 表示ssid模板名称</span><br><span class="line">  ssid comlan            //comlan 表示SSID名称</span><br><span class="line">配置安全认证模板</span><br><span class="line">wlan</span><br><span class="line"> security-profile name sec_psk     //sec_psk为认证模板名称，方式为PSK密码认证；名称可用认证类型来定义，比如raduis </span><br><span class="line">  security wpa-wpa2 psk pass-phrase comlan888 aes   //表示加密类型wpa-wap2 认证密码为comlan888</span><br><span class="line">配置vap模板</span><br><span class="line">wlan</span><br><span class="line"> vap-profile name vap_comlan    //vap-comlan表示模板名称，</span><br><span class="line"> service-vlan vlan-id 101      //PC端获取的vlan</span><br><span class="line"> ssid-profile ssid-cmcc       //调用配置的SSID模板</span><br><span class="line"> security-profile sec_psk      //调用配置的安全模板</span><br><span class="line">配置AP组</span><br><span class="line">wlan</span><br><span class="line"> ap-group name default</span><br><span class="line">  vap-profile vap_comlan wlan 1 radio 0 </span><br><span class="line">  vap-profile vap_comlan wlan 1 radio 1</span><br><span class="line">  OR</span><br><span class="line">  vap-profile vap_comlan wlan 1 radio all     //0表示2.4G 1表示5G wlan 1表示第一个无线(可理解为wlan1 是第一个SSID wlan 2 是第二个SSID)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">此为最基本配置，pc端可正常连接AP，且可以获取业务网段IP地址，AC 和AP此时为2层网络互通，如配置3层互通需配置option</span><br></pre></td></tr></table></figure><h2 id="三层组网"><a href="#三层组网" class="headerlink" title="三层组网"></a>三层组网</h2><p><a href="https://img.ksdn.org/i/2024/08/25/66cb4c155862c.png"></a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">实验详情</span><br><span class="line">配置需求</span><br><span class="line"> 1. AP AC不在同一网段</span><br><span class="line"> 2. 核心作为DCHP 服务器为AP 和Client分配地址</span><br><span class="line"> 3. AP地址网段 VLAN10 172.16.20.0 24</span><br><span class="line"> 4. Client地址网段 VLAN20 192.168.20.0 24</span><br><span class="line"> 5. 所有网关都在核心</span><br><span class="line"></span><br><span class="line">与二层组网区别</span><br><span class="line"> 1. AP和AC不在同一vlan</span><br><span class="line"> 2. 需要配置option 43 字段来告诉AP，AC的地址是哪个</span><br><span class="line"></span><br><span class="line">配置详情</span><br><span class="line"> 1. 核心</span><br><span class="line">  vlan batch vlan 10 20 30 </span><br><span class="line">  int vlan 10 </span><br><span class="line">   des AP-MGT</span><br><span class="line">   ip add 172.16.20.0 24</span><br><span class="line">   dhcp select global</span><br><span class="line">  int vlan 20 </span><br><span class="line">   des Client-DCHP </span><br><span class="line">   ip add 192.168.20.0 24</span><br><span class="line">   dchp select global</span><br><span class="line">  int vlan 30</span><br><span class="line">   des to-AC</span><br><span class="line">   ip add 172.16.10.254 24</span><br><span class="line">  ip pool vlan10</span><br><span class="line">   network 172.16.20.0 mask 24</span><br><span class="line">   gat 172.16.20.254</span><br><span class="line">   option 43 sub-option 3 ascii 172.16.10.253</span><br><span class="line">  ip pool vlan20</span><br><span class="line">   network 192.168.20.0 24</span><br><span class="line">   gat 192.168.20.254</span><br><span class="line">  int g0/0/1</span><br><span class="line">   port link-type trunk</span><br><span class="line">   port trunk allow-pass vlan all</span><br><span class="line">  int g0/0/2</span><br><span class="line">   port link-type trunk</span><br><span class="line">   port trunk allow-pass vlan all</span><br><span class="line">   port trunk pvid vlan 10</span><br><span class="line">  int g0/0/3</span><br><span class="line">   port link-type trunk</span><br><span class="line">   port trunk allow-pass vlan all</span><br><span class="line">   port trunk pvid vlan 10</span><br><span class="line">  int g0/0/4</span><br><span class="line">   port link-type trunk </span><br><span class="line">   port trunk allow-pass vlan all</span><br><span class="line">   port trunk pvid vlan 10</span><br><span class="line">  2. AC配置</span><br><span class="line">   vlan 30 </span><br><span class="line">   int vlan 30</span><br><span class="line">    ip add 172.16.10.253 24</span><br><span class="line">    quit</span><br><span class="line">   wlan </span><br><span class="line">    reg name defalt </span><br><span class="line">     coun CN</span><br><span class="line">    ap-group name default</span><br><span class="line">     reg default</span><br><span class="line">    ap auth-mode no-auth</span><br><span class="line">    quit</span><br><span class="line">   capwap sou inter vlanif 30 </span><br><span class="line"></span><br><span class="line">   ***</span><br><span class="line">   sec name auth-psk</span><br><span class="line">    sec wpa-wpa2 psk pass-phrase comlan888 aes</span><br><span class="line">   ssid name ssid-cmcc</span><br><span class="line">    ssid cmcc</span><br><span class="line">   vap-profile name vap-cmcc</span><br><span class="line">    for dir</span><br><span class="line">    sec auth-psk</span><br><span class="line">    ssid ssid-cmcc</span><br><span class="line">    service-vlan vlan-id 20 </span><br><span class="line">   ap-group name default</span><br><span class="line">    vap-profile vap-cmcc wlan 1 radio 0 </span><br><span class="line">    vap-profile vap-cmcc wlan 1 radio 1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 无线 </tag>
            
            <tag> huawei </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cisco9800无线控制器配置</title>
      <link href="/posts/9be49729.html"/>
      <url>/posts/9be49729.html</url>
      
        <content type="html"><![CDATA[<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">设备类型: 思科9800无线控制器 v17.x+</span><br><span class="line">=======================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">可以正常访问web界面，但是无法登录，提示登录失败</span><br><span class="line">ip http server</span><br><span class="line">ip http authentication local</span><br><span class="line">ip http secure-server</span><br><span class="line">ip http secure-trustpoint CISCO_IDEVID_SUDI \\重点</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">无线部署流程</span><br><span class="line">========================</span><br><span class="line">定义内网vlan-定义AP管理接口或vlan-定义wlan-定义policy-定义tags-将wlan和policy绑定在tags-将tags绑定在AP</span><br><span class="line"></span><br><span class="line">AP绑定tags时，AP会掉线历时大概30s</span><br><span class="line"></span><br><span class="line">HA - SSO 手动主备切换</span><br><span class="line">========================</span><br><span class="line">    在活动 WLC 上发出冗余强制切换命令。此命令将触发手动切换，活动 WLC 将重新启动，备用 WLC 将接管网络。在这种情况下，活动 WLC 上的客户端将被取消身份验证并重新加入新的活动 WLC。</span><br><span class="line">    redundancy force-switchover</span><br></pre></td></tr></table></figure><h2 id="客户端上线日志"><a href="#客户端上线日志" class="headerlink" title="客户端上线日志"></a>客户端上线日志</h2><p><a href="https://img.ksdn.org/i/2024/08/25/66cb4ac16df74.png"></a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">客户端连接成功</span><br><span class="line">[client-orch-sm] [21109]：（注）：MAC：f0c1.f10b.8ac1 Association received。BSSID 7069.5a51.4ec0，旧 BSSID 0000.0000.0000，WLAN RomanTest，插槽0 AP 7069.5a51.4ec0，AP4C77.6D9E.6162</span><br><span class="line">[client-orch-state] [21109]：（注）：MAC：f0c1.f10b.8ac1 客户端状态转换：S_CO_INIT -&gt; S_CO_ASSOCIATING[dot11] [21109]: (note): MAC: f0c1.f10b.8ac1关联成功。AID 1，漫游 = 假，WGB = 假，11r = 假，11w = 假 AID 列表：0x1|0x0| 0x0| 0x0</span><br><span class="line">[client-orch-state] [21109]：（注）：MAC：f0c1.f10b.8ac1 客户端状态转换：S_CO_ASSOCIATING -&gt; S_CO_L2_AUTH_IN_PROGRESS</span><br><span class="line">[client-auth] [21109]: (note): MAC: f0c1.f10b.8ac1 ADD MOBILE 已发送。客户端状态标志：0x71 BSSID：MAC：7069.5a51.4ec0 capwap IFID：0x90000004</span><br><span class="line">[client-auth] [21109]：（注）：MAC：f0c1.f10b.8ac1 L2 身份验证已启动。方法 DOT1X，策略 VLAN 1477，AAA 覆盖 = 0，NAC = 0</span><br><span class="line">[ewlc-infra-evq] [21109]：（注）：身份验证成功。已解决策略位图：客户端 f0c1.f10b.8ac1 的 11[client-auth] [21109]: (note): MAC: f0c1.f10b.8ac1 L2 Authentication Key Exchange Start。已解析 VLAN：1477，审核会话 ID：1E27300A0000000E127592C3</span><br><span class="line">[client-keymgmt] [21109]: (注): MAC: f0c1.f10b.8ac1 EAP 密钥管理成功。AKM:DOT1X 密码:CCMP WPA2[client-orch-sm] [21109]：（注）：MAC：f0c1.f10b.8ac1 移动发现已触发。客户端模式：本地</span><br><span class="line">[client-orch-state] [21109]：（注）：MAC：f0c1.f10b.8ac1 客户端状态转换：S_CO_L2_AUTH_IN_PROGRESS -&gt;S_CO_MOBILITY_DISCOVERY_IN_PROGRESS</span><br><span class="line">[mm-client] [21109]：（注）：MAC：f0c1.f10b.8ac1 移动成功。漫游类型无，子漫游类型 MM_SUB_ROAM_TYPE_NONE，以前的 BSSID MAC：0000.0000.0000 客户端 IFID：0xa0000001，客户端角色：本地 PoA：0x90000004 PoP：0x0</span><br><span class="line">[client-auth] [21109]: (note): MAC: f0c1.f10b.8ac1 ADD MOBILE 已发送。客户端状态标志：0x72 BSSID：MAC：7069.5a51.4ec0 capwap IFID：0x90000004</span><br><span class="line">[client-orch-state] [21109]：（注）：MAC：f0c1.f10b.8ac1 客户端状态转换：S_CO_MOBILITY_DISCOVERY_IN_PROGRESS -&gt;S_CO_DPATH_PLUMB_IN_PROGRESS[dot11] [21109]: (note): MAC: f0c1.f10b.8ac1 Client datapath entry params - ssid:RomanTest,slot_id:0 bssid ifid: 0x0, radio_ifid: 0x90000003,wlan_ifid: 0xf0400002</span><br><span class="line">[dpath_svc] [21109]：（注）：MAC：f0c1.f10b.8ac1 为 ifid 0xa0000001 创建的客户端数据路径条目</span><br><span class="line">[client-orch-state] [21109]: (note): MAC: f0c1.f10b.8ac1 Client state transition: S_CO_DPATH_PLUMB_IN_PROGRESS -&gt; S_CO_IP_LEARN_IN_PROGRESS[client-iplearn] [21109]: (note): MAC: f0c1.f10b.8ac1客户端IP学习成功。方法：DHCP IP：192.168.77.200[client-orch-state] [21109]：（注）：MAC：f0c1.f10b.8ac1 客户端状态转换：S_CO_IP_LEARN_IN_PROGRESS -&gt; S_CO_RUN</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> 思科 </tag>
            
            <tag> 无线 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>锐捷交换机端口聚合</title>
      <link href="/posts/838d1c89.html"/>
      <url>/posts/838d1c89.html</url>
      
        <content type="html"><![CDATA[<h2 id="锐捷交换机端口聚合"><a href="#锐捷交换机端口聚合" class="headerlink" title="锐捷交换机端口聚合"></a>锐捷交换机端口聚合</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int ten 0/25</span><br><span class="line">    port-group 1</span><br><span class="line">int ten 0/26</span><br><span class="line">    port-group 1</span><br><span class="line">int agg1</span><br><span class="line">    sw mo trunk</span><br><span class="line">    exit</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 交换机 </tag>
            
            <tag> ssh </tag>
            
            <tag> ruijie </tag>
            
            <tag> 锐捷 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>锐捷交换机SSH配置</title>
      <link href="/posts/820a8222.html"/>
      <url>/posts/820a8222.html</url>
      
        <content type="html"><![CDATA[<h2 id="锐捷交换机SSH配置"><a href="#锐捷交换机SSH配置" class="headerlink" title="锐捷交换机SSH配置"></a>锐捷交换机SSH配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">username user10 password ruijie@123 //新建用户user10,密码为ruijie@123</span><br><span class="line">crypto key generate rsa //创建加密秘钥</span><br><span class="line">enable service ssh-server //开启ssh服务</span><br><span class="line">line vty 0 4</span><br><span class="line"> transport input ssh  //允许ssh协议传输</span><br><span class="line"> login local //登录为本地身份认证</span><br><span class="line">enable password ruijie@123 //enable密码</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 交换机 </tag>
            
            <tag> ssh </tag>
            
            <tag> ruijie </tag>
            
            <tag> 锐捷 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>锐捷无线控制器双机配置</title>
      <link href="/posts/57c32171.html"/>
      <url>/posts/57c32171.html</url>
      
        <content type="html"><![CDATA[<h2 id="授权信息"><a href="#授权信息" class="headerlink" title="授权信息"></a>授权信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">型号： RG-WS6008</span><br><span class="line">设备购买后，会收到设备授权书(电子版或纸制版)</span><br><span class="line">授权绑定及激活  (按照真实情况填写就行)</span><br><span class="line">https://pa.ruijie.com.cn/main_wireless.jsf#</span><br><span class="line"></span><br><span class="line">授权导入</span><br><span class="line">https://search.ruijie.com.cn:8447/rqs/preview.html?wd=eHAiOjE1NDU4NzUxNDcsIm5iZiI6MTU0NTYxNTk0N302018092015271100191LqqZuvMhE7V7Ygl6r5RWsTHbWazT</span><br></pre></td></tr></table></figure><h2 id="双机配置"><a href="#双机配置" class="headerlink" title="双机配置"></a>双机配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">VAC虚拟化场景下，AC退出License不足时，多久AP会掉线？</span><br><span class="line"></span><br><span class="line">有AC退出，其设备上安装的license会保留一段时间，这个时间叫做license老化时间，支持可配置。License老化时间 到期后，AC还没有重新加入的话，剩下的AC上，license不足，超出license的AP将被踢下线。如果是AC硬件故障，不能及时加入，可通过临时license先顶着。</span><br><span class="line">License老化时间在B9P5及之后版本，默认为168小时（7天），可调整范围1小时~336小时（14天）；B9P5之前的版本，默认为24小时（1天），可调整范围1小时~168小时（7天）。</span><br><span class="line">License老化时间调整的方法：</span><br><span class="line">VAC(config)# ac-controller</span><br><span class="line">VAC(config-ac)# license-idle-timeout 336    # 单位：小时</span><br><span class="line"></span><br><span class="line"># 双机配置 - 主机</span><br><span class="line">device virtual domain 100 # 创建虚拟domain ID</span><br><span class="line">!</span><br><span class="line">device 1 # 设备ID</span><br><span class="line">device 1 priority 200 # 设备优先级，越高越优先</span><br><span class="line"></span><br><span class="line">vac-port</span><br><span class="line">port-member interface GigabitEthernet 0/5 copper # 心跳口(堆叠口)</span><br><span class="line">port-member interface GigabitEthernet 0/6 copper # 心跳口(堆叠口)</span><br><span class="line"></span><br><span class="line">device convert mode virtual #切换为vac模式</span><br><span class="line"></span><br><span class="line"># 双机配置 - 备机</span><br><span class="line">device virtual domain 100 # 创建虚拟domain ID</span><br><span class="line">!</span><br><span class="line">device 2 # 设备ID</span><br><span class="line">device 2 priority 200 # 设备优先级，越高越优先</span><br><span class="line"></span><br><span class="line">vac-port</span><br><span class="line">port-member interface GigabitEthernet 0/5 copper # 心跳口(堆叠口)</span><br><span class="line">port-member interface GigabitEthernet 0/6 copper # 心跳口(堆叠口)</span><br><span class="line"></span><br><span class="line">device convert mode virtual #切换为vac模式</span><br><span class="line"></span><br><span class="line"># bdf双活检测</span><br><span class="line">virtual-ac domain 100</span><br><span class="line"> dual-active detection bfd # bfd检测</span><br><span class="line"> dual-active bfd interface GigabitEthernet 1/0/4 # 检测口</span><br><span class="line"> dual-active bfd interface GigabitEthernet 2/0/4 #检测口</span><br><span class="line"> slave preemptive enable #主控制器抢占</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 无线 </tag>
            
            <tag> ruijie </tag>
            
            <tag> 锐捷 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cisco交换机流量镜像</title>
      <link href="/posts/a8d6f45c.html"/>
      <url>/posts/a8d6f45c.html</url>
      
        <content type="html"><![CDATA[<h1 id="基于接口的流量镜像"><a href="#基于接口的流量镜像" class="headerlink" title="基于接口的流量镜像"></a>基于接口的流量镜像</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">monitor session 1 source interface g3/1 - 12 both</span><br><span class="line">monitor session 1 source interface g2/1 - 12 both</span><br><span class="line">monitor session 1 destination interface g3/24</span><br></pre></td></tr></table></figure><h2 id="基于vlan的流量镜像"><a href="#基于vlan的流量镜像" class="headerlink" title="基于vlan的流量镜像"></a>基于vlan的流量镜像</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">monitor session 1 source vlan 1 ， 20 </span><br><span class="line">monitor session 1 destination intferface g3/24</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> 流量镜像 </tag>
            
            <tag> 思科 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华为交换机配置dot1x认证，并配置语音vlan</title>
      <link href="/posts/374852ca.html"/>
      <url>/posts/374852ca.html</url>
      
        <content type="html"><![CDATA[<h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Version</span><br><span class="line">Huawei Versatile Routing Platform Software</span><br><span class="line">VRP (R) software, Version 5.170 (S5735 V200R019C00SPC500)</span><br></pre></td></tr></table></figure><h2 id="dot1x-配置"><a href="#dot1x-配置" class="headerlink" title="dot1x 配置"></a>dot1x 配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1. radius配置</span><br><span class="line">radius-server template radius_temp # 定义radius服务模板</span><br><span class="line"> radius-server shared-key cipher Cisco@123</span><br><span class="line"> radius-server authentication 10.1.210.1 1812 weight 80</span><br><span class="line"> radius-server accounting 10.1.210.1 1813 weight 80</span><br><span class="line"> quit</span><br><span class="line"></span><br><span class="line">2. aaa配置</span><br><span class="line">aaa</span><br><span class="line">    authentication-scheme aaa_auth1 # 定义aaa认证方式为radius</span><br><span class="line">     authentication-mode radius</span><br><span class="line">    domain aaa_auth_domain # 定义认证domian</span><br><span class="line">      authentication-scheme aaa_auth1 # 关联认证方式</span><br><span class="line">      radius-server radius_temp # 关联radius认证服务模板</span><br><span class="line">    quit</span><br><span class="line"></span><br><span class="line">3. dot1x profile文件配置</span><br><span class="line">dot1x-access-profile name acc_dot1x </span><br><span class="line"> dot1x authentication-method eap</span><br><span class="line"> dot1x timer client-timeout 30</span><br><span class="line"> quit</span><br><span class="line"></span><br><span class="line">4. mac profile文件配置</span><br><span class="line">mac-access-profile name mac_auth</span><br><span class="line"> mac-authen username macaddress format with-hyphen</span><br><span class="line"> quit</span><br><span class="line"></span><br><span class="line">5. auth profile文件配置</span><br><span class="line">authentication-profile name auth_dot1x</span><br><span class="line"> dot1x-access-profile acc_dot1x # 调用dot1x接入配置文件</span><br><span class="line"> mac-access-profile mac_auth #调用mac认证接入配置文件</span><br><span class="line"> access-domain aaa_auth_domain force 调用认证domain集</span><br><span class="line"> authentication dot1x-mac-bypass # mac认证bypass</span><br><span class="line"></span><br><span class="line">6. 接口启用认证</span><br><span class="line">int g0/0/2 </span><br><span class="line">   authentication-profile auth_dot1x</span><br></pre></td></tr></table></figure><h2 id="语音vlan配置"><a href="#语音vlan配置" class="headerlink" title="语音vlan配置"></a>语音vlan配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port link-type hybrid    #端口模式</span><br><span class="line"> voice-vlan 111 enable    #语音vlan</span><br><span class="line"> port hybrid tagged vlan 111    #语音vlan</span><br><span class="line"> port hybrid pvid vlan 114    #业务vlan</span><br><span class="line"> port hybrid untagged vlan 114    # 业务vlan</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> huawei </tag>
            
            <tag> 交换机 </tag>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华为交换机端口聚合</title>
      <link href="/posts/94a67536.html"/>
      <url>/posts/94a67536.html</url>
      
        <content type="html"><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Huawei Versatile Routing Platform Software</span><br><span class="line">VRP (R) software, Version 5.170 (S5731 V200R020C10SPC500)</span><br></pre></td></tr></table></figure><h2 id="华为交换机端口聚合"><a href="#华为交换机端口聚合" class="headerlink" title="华为交换机端口聚合"></a>华为交换机端口聚合</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">int eth-trunk 1</span><br><span class="line"></span><br><span class="line">    mode lacp</span><br><span class="line"></span><br><span class="line">    port link-type trunk</span><br><span class="line"></span><br><span class="line">    port trunk all vlan all</span><br><span class="line"></span><br><span class="line">int g0/0/23</span><br><span class="line"></span><br><span class="line">    eth-trunk 1</span><br><span class="line"></span><br><span class="line">    lacp pri 100</span><br><span class="line"></span><br><span class="line">int g0/0/24 </span><br><span class="line"></span><br><span class="line">    eth-trunk 1</span><br><span class="line"></span><br><span class="line">    lacp pri 100</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> huawei </tag>
            
            <tag> 交换机 </tag>
            
            <tag> ssh </tag>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华为交换机SSH配置</title>
      <link href="/posts/c3a383cf.html"/>
      <url>/posts/c3a383cf.html</url>
      
        <content type="html"><![CDATA[<h2 id="华为交换机SSH配置"><a href="#华为交换机SSH配置" class="headerlink" title="华为交换机SSH配置"></a>华为交换机SSH配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">SSH 配置</span><br><span class="line">    #新建rsa秘钥</span><br><span class="line">rsa local-key-pair create  </span><br><span class="line"></span><br><span class="line">user-interface vty 0 4 </span><br><span class="line"></span><br><span class="line">authentication-mode aaa # 配置登录方式为aaa认证</span><br><span class="line"></span><br><span class="line">protocol inbound ssh # 允许ssh协议登录</span><br><span class="line"></span><br><span class="line">aaa</span><br><span class="line"></span><br><span class="line">    undo local-aaa-user password policy administrator # 关闭系统默认的密码到期更改提醒</span><br><span class="line"></span><br><span class="line">    local-user usertest password irreversible-cipher Cisco@123 privilege level 3</span><br><span class="line"></span><br><span class="line">    local-user usertest service-type terminal ssh</span><br><span class="line"></span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line">stelnet server enable # 开启ssh服务</span><br><span class="line"></span><br><span class="line">ssh user usertest service-type stelnet # 设置usertest使用的允许的协议</span><br><span class="line"></span><br><span class="line">ssh user usertest authentication-type password # 设置usertest使用的认证方式</span><br><span class="line"></span><br><span class="line">某些新版本需要添加可访问的源接口</span><br><span class="line">ssh server-source all-interface //ssh协议</span><br><span class="line">http server-source all-interface //http协议</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> huawei </tag>
            
            <tag> 交换机 </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华为交换机双线路冗余及自动切换</title>
      <link href="/posts/d5e68f65.html"/>
      <url>/posts/d5e68f65.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>环境背景：</p></blockquote><ol><li>核心交换机堆叠配置</li><li>客户一台防火墙双线连接核心交换机，2个3层口(防火墙不做端口聚合)</li></ol><h2 id="配置详情"><a href="#配置详情" class="headerlink" title="配置详情"></a>配置详情</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">核心交换机Track配置</span><br><span class="line"></span><br><span class="line">====监测配置1====</span><br><span class="line">nqa test-instance user nqa1 //创建nqa1</span><br><span class="line"></span><br><span class="line">test-type icmp //设置类型为icmp，也就是ping</span><br><span class="line"></span><br><span class="line">destination-address ipv4 192.168.111.1 //设置目标IP，也就是运营商给的网关IP</span><br><span class="line"></span><br><span class="line">frequency 15 // 设置NQA自动执行测试的时间间隔为15秒</span><br><span class="line"></span><br><span class="line">interval seconds 5 //设置NQA发送报文的时间间隔为5秒</span><br><span class="line"></span><br><span class="line">start now //立即开始</span><br><span class="line"></span><br><span class="line">====监测配置2====</span><br><span class="line">nqa test-instance user nqa2</span><br><span class="line"></span><br><span class="line">test-type icmp</span><br><span class="line"></span><br><span class="line">destination-address ipv4 192.168.222.2</span><br><span class="line"></span><br><span class="line">frequency 15</span><br><span class="line"></span><br><span class="line">interval seconds 5</span><br><span class="line"></span><br><span class="line">start now</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 192.168.111.1 track nqa user nqa1</span><br><span class="line"></span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 221.6.4.1 preference 90 track nqa user nqa2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> huawei </tag>
            
            <tag> 交换机 </tag>
            
            <tag> 华为 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Checkpoint相关配置</title>
      <link href="/posts/abffad84.html"/>
      <url>/posts/abffad84.html</url>
      
        <content type="html"><![CDATA[<h2 id="重置SIC密码"><a href="#重置SIC密码" class="headerlink" title="重置SIC密码"></a>重置SIC密码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">进入系统后台</span><br><span class="line">尖角号模式下输入cpconfig</span><br><span class="line">vm-gw&gt; cpconfig</span><br><span class="line">This program will let you re-configure</span><br><span class="line">your Check Point products configuration.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Configuration Options:</span><br><span class="line">----------------------</span><br><span class="line">(1)  Licenses and contracts</span><br><span class="line">(2)  SNMP Extension</span><br><span class="line">(3)  PKCS#11 Token</span><br><span class="line">(4)  Random Pool</span><br><span class="line">(5)  Secure Internal Communication</span><br><span class="line">(6)  Enable cluster membership for this gateway</span><br><span class="line">(7)  Check Point CoreXL</span><br><span class="line">(8)  Automatic start of Check Point Products</span><br><span class="line"></span><br><span class="line">(9) Exit</span><br><span class="line"></span><br><span class="line">Enter your choice (1-9) :5</span><br><span class="line">Configuring Secure Internal Communication...</span><br><span class="line">============================================</span><br><span class="line">The Secure Internal Communication is used for authentication between</span><br><span class="line">Check Point components</span><br><span class="line"></span><br><span class="line">Trust State: Trust established</span><br><span class="line"></span><br><span class="line"> Would you like re-initialize communication? (y/n) [n] ? y</span><br><span class="line"></span><br><span class="line">Note: The Secure Internal Communication will be reset now,</span><br><span class="line">and all Check Point Services will be stopped (cpstop).</span><br><span class="line">No communication will be possible until you reset and</span><br><span class="line">re-initialize the communication properly!</span><br><span class="line">Are you sure? (y/n) [n] ? y</span><br><span class="line">Enter Activation Key: </span><br><span class="line">Retype Activation Key: </span><br><span class="line">initial_module:</span><br><span class="line">Compiled OK.</span><br><span class="line">initial_module:</span><br><span class="line">Compiled OK.</span><br></pre></td></tr></table></figure><h2 id="进入专家后台"><a href="#进入专家后台" class="headerlink" title="进入专家后台"></a>进入专家后台</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">配置专家模式密码</span><br><span class="line">vm-gw1&gt; set expert-password</span><br><span class="line">  Enter new expert password: </span><br><span class="line">Enter new expert password (again):</span><br><span class="line">  配置密码时不显示，直接输入即可</span><br><span class="line">vm-gw1&gt; expert</span><br><span class="line">  Enter expert password: //输入专家模式密码</span><br></pre></td></tr></table></figure><h2 id="端口抓包"><a href="#端口抓包" class="headerlink" title="端口抓包"></a>端口抓包</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CP专家模式为linux系统，使用tcpdump抓包</span><br><span class="line">tcpdump -i eth0 icmp</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> checkpoint </tag>
            
            <tag> 抓包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx安装教程</title>
      <link href="/posts/3d4dabe8.html"/>
      <url>/posts/3d4dabe8.html</url>
      
        <content type="html"><![CDATA[<h2 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">nginx依赖软件： </span><br><span class="line">    1. GCC编译器</span><br><span class="line">        #GCC编译器和G++，用于编写Nginx HTTP模块</span><br><span class="line">        yum install gcc</span><br><span class="line">        yum install gcc-gcc+</span><br><span class="line">    2. PCRE库</span><br><span class="line">        #函数库，支持正则表达式，如果在nginx.conf里面使用了正则表达式，那么编译Nginx时就必须引进PCRE库，用于解析HTTP模块的正则表达式,</span><br><span class="line">        yum install pcre pcre-devel</span><br><span class="line">    3. zlib库</span><br><span class="line">        #用于对http包的内容做gzip格式的压缩。</span><br><span class="line">        yum install zlib zlib-devel</span><br><span class="line">    4. openssl开发库</span><br><span class="line">        #使用SSL协议上安全传输HTTP，就是所谓的https</span><br><span class="line">        yum install openssl openssl-devel</span><br><span class="line">    </span><br><span class="line">1. 源码安装</span><br><span class="line">    1.1 下载源码包并解压</span><br><span class="line">        wget http://nginx.org/download/nginx-1.16.1.tar.gz </span><br><span class="line">        tar -zxvf nginx-1.16.1.tar.gz </span><br><span class="line">    1.2 编译</span><br><span class="line">        进入解压后的目录</span><br><span class="line">        ./comfigure</span><br><span class="line">        make</span><br><span class="line">        make install</span><br><span class="line">        nginx默认安装到/usr/local/nginx/sbin/nginx目录</span><br></pre></td></tr></table></figure><h2 id="nginx配置文件详解"><a href="#nginx配置文件详解" class="headerlink" title="nginx配置文件详解"></a>nginx配置文件详解</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"># 当生成一些文件的时候，所属的用户和组</span><br><span class="line">user www-data;</span><br><span class="line">    </span><br><span class="line"># 启动子进程(worker)数，可以通过`ps aux | grep nginx`</span><br><span class="line"></span><br><span class="line">#查看，一般设置成CPU核数。</span><br><span class="line">worker_processer 1;</span><br><span class="line">    </span><br><span class="line"># 全局错误日志，这里的“当前目录”为/usr/local/nginx</span><br><span class="line">error_log logs/error.log; # 默认</span><br><span class="line">    </span><br><span class="line"># 保存PID的log</span><br><span class="line">pid logs/nginx.pid; # 默认</span><br><span class="line">    </span><br><span class="line"># 工作模式和连接数上限</span><br><span class="line">events&#123;</span><br><span class="line">    # epoll是多路复用IO中的一种方式，仅用于linux2.6以上的内核，可以大大提高nginx的性能</span><br><span class="line">    use epoll;</span><br><span class="line">    # 单个worker process进程的最大并发连接数，受系统文件句柄限制，即`ulimit -a`中open files项</span><br><span class="line">    worker_connections 65535;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"># 设定http服务器</span><br><span class="line">http&#123;</span><br><span class="line">    # 设定mime类型，mime.types为“文件类型定义”文件，“当前目录”为conf/</span><br><span class="line">    include mime.types;</span><br><span class="line">    </span><br><span class="line">    # 默认文件类型</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    # 默认编码</span><br><span class="line">    # charset utf-8;</span><br><span class="line">    </span><br><span class="line">    # 反向代理配置，可以打开proxy.conf看看</span><br><span class="line">    # include proxy.conf;</span><br><span class="line">    </span><br><span class="line">    # fastcgi配置，可以打开fastcgi.conf看看</span><br><span class="line">    # include fastcgi.conf; </span><br><span class="line">    </span><br><span class="line">    # 定义log文件怎么写</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    # 全局访问日志，使用以上定义的main格式</span><br><span class="line">    access_log logs/access.log main;</span><br><span class="line">    </span><br><span class="line">    # sendfile指令指定nginx是否调用sendfile函数[零拷贝方式](http://baike.baidu.com/view/704944.htm)来输出文件。这是一个提高通信效率但是降低数据传输速率的函数，只有在用来进行下载等应用磁盘IO重负载的应用中设置为off</span><br><span class="line">    sendfile on;</span><br><span class="line">    </span><br><span class="line">    # 服务器的响应头部信息产生独立的数据包发送，即一个响应头信息=&gt;一个包</span><br><span class="line">    tcp_nopush on;</span><br><span class="line">    </span><br><span class="line">    # 保持连接的超时时间</span><br><span class="line">    keepalive_timeout 65;</span><br><span class="line">    </span><br><span class="line">    # 页面压缩后传输更节省流量</span><br><span class="line">    gzip on;</span><br><span class="line">    </span><br><span class="line">    # 防止网络阻塞</span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    </span><br><span class="line">    # 服务器名字的hash表大小</span><br><span class="line">    # server_names_hash_bucket_size 128;</span><br><span class="line">    </span><br><span class="line">    # 上传文件大小限制</span><br><span class="line">    # client_header_buffer_size 32k;</span><br><span class="line">    </span><br><span class="line">    # 设定请求缓存</span><br><span class="line">    # large_client_header_buffers 4 64k;</span><br><span class="line">    # client_max_body_size 8m;</span><br><span class="line">    </span><br><span class="line">    # 开启限制IP连接数的时候需要使用</span><br><span class="line">    # limit_zone crawler $binary_remote_addr 10m;</span><br><span class="line">    </span><br><span class="line">    # 包含每个server的配置</span><br><span class="line">    # include /usr/local/nginx/myconf/*.conf;</span><br><span class="line">    </span><br><span class="line">    # server可以include进来，也可以直接写在后面，用于定义虚拟主机。最重要的是字段是server_name和root</span><br><span class="line">    server&#123;</span><br><span class="line">        # 服务器监听端口</span><br><span class="line">        listen 7890;</span><br><span class="line">        </span><br><span class="line">        # 访问域名</span><br><span class="line">        server_name www.example.com</span><br><span class="line">        #编码格式，如果网页编码与此设置不同，则将被自动转码，覆盖全局的编码。。</span><br><span class="line">        # charset koi8-r;</span><br><span class="line">        </span><br><span class="line">        # 设置虚拟主机的访问日志</span><br><span class="line">        # access_log logs/www.example.com.access.log main;</span><br><span class="line">        </span><br><span class="line">        #对URL进行匹配，访问server_name的时候进入这里</span><br><span class="line">        location / &#123;</span><br><span class="line">            # 网页根目录，“当前目录”在nginx的安装目录，即/usr/local/nginx，可以用绝对路径或相对路径，以下的html是相对安装目录</span><br><span class="line">            root html;</span><br><span class="line">            </span><br><span class="line">            # 默认的首页文件(有先后顺序)，访问www.example.com则寻找root下的index.html返回，如果找不到，就找index.htm</span><br><span class="line">            index index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        # 设置错误代码对应的错误页面</span><br><span class="line">        # error_page 404 /404.html</span><br><span class="line">        # error_page 500 502 503 504 /50x.html</span><br><span class="line">        </span><br><span class="line">        # 略去配置代理和HTTPS Server</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tcpdump抓包</title>
      <link href="/posts/93641cfa.html"/>
      <url>/posts/93641cfa.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tcpdump tcp -i eth1 -t -s 0 -c 100 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.cap</span><br><span class="line">(1)tcp: ip icmp arp rarp 和 tcp、udp、icmp这些选项等都要放到第一个参数的位置，用来过滤数据报的类型</span><br><span class="line">(2)-i eth1 : 只抓经过接口eth1的包</span><br><span class="line">(3)-t : 不显示时间戳</span><br><span class="line">(4)-s 0 : 抓取数据包时默认抓取长度为68字节。加上-S 0 后可以抓到完整的数据包</span><br><span class="line">(5)-c 100 : 只抓取100个数据包</span><br><span class="line">(6)dst port ! 22 : 不抓取目标端口是22的数据包</span><br><span class="line">(7)src net 192.168.1.0/24 : 数据包的源网络地址为192.168.1.0/24</span><br><span class="line">(8)-w ./target.cap : 保存成cap文件，方便用ethereal(即wireshark)分析 - 可选参数</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 抓包 </tag>
            
            <tag> tcpdump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Juniper SRX多出口线路冗余</title>
      <link href="/posts/67dcd0ba.html"/>
      <url>/posts/67dcd0ba.html</url>
      
        <content type="html"><![CDATA[<h2 id="RPM配置"><a href="#RPM配置" class="headerlink" title="RPM配置"></a>RPM配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">解决场景：</span><br><span class="line">Juniper多链路出口，路由主备，链路故障后，自动切换，同时不影响多链路的Dnat</span><br><span class="line">关键词解释：</span><br><span class="line">Successive-Loss 连续丢包数</span><br><span class="line">Total-Loss 总丢包数</span><br><span class="line"></span><br><span class="line">联通链路rpm</span><br><span class="line">set services rpm probe RpmProbeCU test cu-gateway target address 114.114.114.114 \\探测的目的地址</span><br><span class="line">set services rpm probe RpmProbeCU test cu-gateway probe-count 4 \\发送4个探测包</span><br><span class="line">set services rpm probe RpmProbeCU test cu-gateway probe-interval 5\\4个探测包的间隔为5秒钟</span><br><span class="line">set services rpm probe RpmProbeCU test cu-gateway test-interval 5\\完成4个探测包后，距离下次探测的间隔时间</span><br><span class="line">set services rpm probe RpmProbeCU test cu-gateway source-address 10.1.1.2 \\已10.1.1.2为源进行探测</span><br><span class="line">set services rpm probe RpmProbeCU test cu-gateway thresholds successive-loss 3 \\连续丢包数为3个</span><br><span class="line">set services rpm probe RpmProbeCU test cu-gateway thresholds total-loss 3 \\总丢包数为3个</span><br><span class="line">电信链路rpm</span><br><span class="line">set services rpm probe RpmProbeCT test ct-gateway target address 114.114.114.114</span><br><span class="line">set services rpm probe RpmProbeCT test ct-gateway probe-count 4</span><br><span class="line">set services rpm probe RpmProbeCT test ct-gateway probe-interval 5</span><br><span class="line">set services rpm probe RpmProbeCT test ct-gateway test-interval 5</span><br><span class="line">set services rpm probe RpmProbeCT test ct-gateway source-address 20.1.1.2</span><br><span class="line">set services rpm probe RpmProbeCT test ct-gateway thresholds successive-loss 3</span><br><span class="line">set services rpm probe RpmProbeCT test ct-gateway thresholds total-loss 3</span><br><span class="line"></span><br><span class="line">rpm监测切换策略</span><br><span class="line">链路故障后，被选中的路由优先级会被系统重置为1，切换时间大概20秒；当链路故障恢复后，会重新切回原来的路由</span><br><span class="line">set services ip-monitoring policy RpmPolicyCU match rpm-probe RpmProbeCU \\如果满足rpm probe监测条件，则执行以下路由，</span><br><span class="line">set services ip-monitoring policy RpmPolicyCU then preferred-route route 0.0.0.0/0 next-hop 20.1.1.1</span><br><span class="line">set services ip-monitoring policy RpmPolicyCT match rpm-probe RpmProbeCT</span><br><span class="line">set services ip-monitoring policy RpmPolicyCT then preferred-route route 0.0.0.0/0 next-hop 10.1.1.1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> juniper </tag>
            
            <tag> 防火墙 </tag>
            
            <tag> SRX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Juniper基本配置</title>
      <link href="/posts/ec251c54.html"/>
      <url>/posts/ec251c54.html</url>
      
        <content type="html"><![CDATA[<h2 id="名词介绍"><a href="#名词介绍" class="headerlink" title="名词介绍"></a>名词介绍</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Cluster-id #：0-15可选，如果等于0不能做HA。</span><br><span class="line">Group #：横向，用于数据控制。</span><br><span class="line">Node id #：竖向，SRX1，SRX2. </span><br><span class="line">gr: GRE隧道接口</span><br><span class="line">ip: ip-over-ip接口</span><br><span class="line">ge: 千兆以太网接口</span><br><span class="line">ae: 聚合以太网接口</span><br><span class="line">as: 聚合SONET/SDH接口</span><br><span class="line">Fxp0：带外管理口。独立于HA，且管理口配置不会进行同步</span><br><span class="line">Fxp1（console Link）：控制层面心跳口。不同型号接口不一样，不做配置。</span><br><span class="line">（可参考：https://www.juniper.net/documentation/us/en/software/junos/chassis-cluster-security-devices/topics/topic-map/security-chassis-cluster-verification.html）</span><br><span class="line">Fab(Fabric Link)#：数据面心跳。模块类型1GE或10GE</span><br><span class="line">Reth#：转发数据口，每个SRX分一个接口捆绑成一个reth#。可理解为冗余端口组</span><br><span class="line"></span><br><span class="line">查看转发会话</span><br><span class="line">show security flow session</span><br><span class="line">查看nat详情</span><br><span class="line">show security nat source rule all</span><br></pre></td></tr></table></figure><h2 id="用户配置"><a href="#用户配置" class="headerlink" title="用户配置"></a>用户配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root用户密码修改及配置</span><br><span class="line">    set system root-authentication plain-text-password</span><br><span class="line">    New password:</span><br><span class="line">    Retype new password:</span><br><span class="line"></span><br><span class="line">新建用户</span><br><span class="line">    set system login user vtg uid 101 class super-user    // super-user 为完全权限                  </span><br><span class="line">    set system login user vtg authentication plain-text-password</span><br><span class="line">    New password:</span><br><span class="line">    Retype new password: </span><br><span class="line">    show cli authorization        //查看当前用户权限</span><br></pre></td></tr></table></figure><h2 id="上网配置"><a href="#上网配置" class="headerlink" title="上网配置"></a>上网配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">1. 配置接口ip地址</span><br><span class="line">    set interfaces ge-0/0/0.0 family inet address 124.207.100.1/24 //注意子网掩码表示方式</span><br><span class="line">     或    </span><br><span class="line">    set interfaces ge-0/0/0 unit 0 family inet address 124.207.100.1/24</span><br><span class="line">   2. 接口划分安全域</span><br><span class="line">    set security zones security-zone untrust interfaces ge-0/0/0.0 //将接口ge-0/0/0.0 划分至非安全域</span><br><span class="line">    set security zones security-zone trust interfaces ge-0/0/1.0</span><br><span class="line">   3. 开启接口可支持的功能或服务</span><br><span class="line">    set security zones security-zone untrust interfaces ge-0/0/0 host-inbound-traffic system-services   ping</span><br><span class="line">    set security zones security-zone untrust interfaces ge-0/0/0 host-inbound-traffic system-services   ssh</span><br><span class="line">    set security zones security-zone untrust interfaces ge-0/0/0 host-inbound-traffic system-services   telnet</span><br><span class="line">    set security zones security-zone untrust interfaces ge-0/0/0 host-inbound-traffic system-services   http</span><br><span class="line">    set security zones security-zone untrust interfaces ge-0/0/0 host-inbound-traffic system-services   https</span><br><span class="line">   4. 建立全局地址簿</span><br><span class="line">    set security address-book global address vlan10 192.168.10.0/24</span><br><span class="line">    set security address-book global address vlan20 192.168.20.0/24</span><br><span class="line">    set security address-book global address vlan30 192.168.30.0/24</span><br><span class="line">    将以上地址放进地址组，如下</span><br><span class="line">    set security address-book global address-set Inside_network address vlan10</span><br><span class="line">    set security address-book global address-set Inside_network address vlan20</span><br><span class="line">    set security address-book global address-set Inside_network address vlan30</span><br><span class="line"></span><br><span class="line">    注意： 做nat时，需调用全局地址簿中的地址，不然会报错，且global为系统内置的对象，需要将地址放置在此处</span><br><span class="line">   5. 源nat配置</span><br><span class="line">    set security nat source rule-set src-nat from zone trust</span><br><span class="line">    set security nat source rule-set src-nat to zone untrust</span><br><span class="line">    set security nat source rule-set src-nat rule id1 match source-address 192.168.10.0/24        //单个ip或单网段</span><br><span class="line">     或</span><br><span class="line">    set security nat source rule-set src-nat rule id1 match source-address-name Inside_network        //调用刚才建立的地址组</span><br><span class="line">    set security nat source rule-set src-nat rule id1 destination-address 0.0.0.0/0</span><br><span class="line">    set security nat source rule-set src-nat rule id1 then source-nat interface        //转换成出接口地址</span><br><span class="line">           </span><br><span class="line">   6. 目的nat配置</span><br><span class="line">    需要先配置nat pool</span><br><span class="line">    例：添加一台需要映射到公网的oa服务器</span><br><span class="line">    set security nat destination pool oa_web address 192.168.10.11/32 port 23        //地址为192.168.10.11 需要映射的端口为23</span><br><span class="line">    目的nat配置</span><br><span class="line">    set security nat destination rule-set dst_nat from zone untrust</span><br><span class="line">    set security nat destination rule-set dst_nat rule id1 match destination-address 124.207.100.2/32</span><br><span class="line">    set security nat destination rule-set dst_nat rule id1 match destination-port 8080</span><br><span class="line">    set security nat destination rule-set dst_nat rule id1 match protocol tcp</span><br><span class="line">    set security nat destination rule-set dst_nat rule id1 then destinatione-nat pool oa_web        //转换对象，调用已配置的pool名称</span><br><span class="line">   7. 策略配置</span><br><span class="line">    默认策略</span><br><span class="line">    trust to trust --- permit any any </span><br><span class="line">      default-permit</span><br><span class="line">    trust to untrust --- permit any any </span><br><span class="line">      default-permit </span><br><span class="line">    untrust to trust --- deny any any </span><br><span class="line">      default-deny</span><br><span class="line">    set security policies from-zone trust to-zone untrust policy default-permit match source-address any destionation-address any application any </span><br><span class="line">    set security policies from-zone trust to-zone untrust policy default-permit then permit</span><br><span class="line"></span><br><span class="line">    新增策略建议，policy 名称设置为policy_id1*</span><br><span class="line">    set security policies from-zone untrust to-zone trust policy policy_id10 match source-address any destionation-address any application any </span><br><span class="line">    set security poilicies from-zone untrust to-zone trust policy policy_id10 then permit</span><br><span class="line"></span><br><span class="line">    策略顺序优先级调整</span><br><span class="line">    after     Insert after given data element     -- 在给定数据元素之后插入之后</span><br><span class="line">    before    Insert before given data element    -- 在给定数据元素之前插入之前</span><br><span class="line">    insert security policies from-zone trust to-zone untrust policy new_policy before policy default-permit  //new_policy default-permit 均为策略名称</span><br></pre></td></tr></table></figure><h2 id="NAT详解"><a href="#NAT详解" class="headerlink" title="NAT详解"></a>NAT详解</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">源地址         目的地址           源地址转换为       目的地址转换为</span><br><span class="line">10.1.1.1       10.5.5.5             172.16.1.1            192.168.1.1</span><br><span class="line">1、源地址转换</span><br><span class="line">set security nat source pool AAA address 172.16.1.1/32 to 172.16.1.1/32    </span><br><span class="line">set security nat source rule-set trust-to-untrust from zone trust</span><br><span class="line">set security nat source rule-set trust-to-untrust to zone untrust</span><br><span class="line">set security nat source rule-set trust-to-untrust rule A-B match source-address 10.1.1.1/32</span><br><span class="line">set security nat source rule-set trust-to-untrust rule A-B match destination-address 192.168.1.1/32</span><br><span class="line">set security nat source rule-set trust-to-untrust rule A-B then source-nat pool AAA</span><br><span class="line"></span><br><span class="line">set security nat source pool BBB address 10.5.5.5/32 to 10.5.5.5/32</span><br><span class="line">set security nat source rule-set untrust-to-trust from zone untrust</span><br><span class="line">set security nat source rule-set untrust-to-trust to zone trust</span><br><span class="line">set security nat source rule-set untrust-to-trust rule B-A match source-address 192.168.1.1/32</span><br><span class="line">set security nat source rule-set untrust-to-trust rule B-A  match destination-address 10.1.1.1/32</span><br><span class="line">set security nat source rule-set untrust-to-trust rule B-A  then source-nat pool BBB</span><br><span class="line"></span><br><span class="line">注：源地址转换时匹配的目的地址是真实的目的地址，因为先进行目的转换再进行源地址转换</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.目的转换</span><br><span class="line">set security nat destination pool CCC address 192.168.1.1/32</span><br><span class="line">set security nat destination rule-set trust-to-untrust from zone trust</span><br><span class="line">set security nat destination rule-set trust-to-untrust rule A-Bmatch source-address 10.1.1.1/32</span><br><span class="line">set security nat destination rule-set trust-to-untrust rule A-B match destination-address 10.5.5.5/32</span><br><span class="line">set security nat destination rule-set trust-to-untrust rule A-B then destination-nat pool CCC</span><br><span class="line"></span><br><span class="line">set security nat destination pool DDD address 10.1.1.1/32</span><br><span class="line">set security nat destination rule-set untrust-to-trust from zone untrust</span><br><span class="line">set security nat destination rule-set untrust-to-trust rule B-A match source-address 192.168.1.1/32</span><br><span class="line">set security nat destination rule-set untrust-to-trust rule B-A match destination-address 172.16.1.1/32</span><br><span class="line">set security nat destination rule-set untrust-to-trust rule B-A then destination-nat pool DDD</span><br><span class="line">3.策略</span><br><span class="line">从trust到untrust</span><br><span class="line">set security zones security-zone trust address-book address EEE 10.1.1.1/32</span><br><span class="line">set security zones security-zone untrust address-book address FFF 192.168.1.1/32</span><br><span class="line">set security policies from-zone trust to-zone untrust policy A-B match source-address EEE</span><br><span class="line">set security policies from-zone trust to-zone untrust policy A-B match destination-address FFF</span><br><span class="line">set security policies from-zone trust to-zone untrust policy A-B match application any</span><br><span class="line">set security policies from-zone trust to-zone untrust policy A-B then permit</span><br><span class="line">set security policies from-zone trust to-zone untrust policy A-B then log session-init</span><br><span class="line">set security policies from-zone trust to-zone untrust policy A-B then log session-close</span><br><span class="line">从untrust到trust</span><br><span class="line">set security policies from-zone untrust to-zone trust policy B-A match source-address FFF</span><br><span class="line">set security policies from-zone untrust to-zone trust policy B-A match destination-address EEE</span><br><span class="line">set security policies from-zone untrust to-zone trust policy B-A match application any</span><br><span class="line">set security policies from-zone untrust to-zone trust policy B-A then permit</span><br><span class="line">set security policies from-zone untrust to-zone trust policy B-A then log session-init</span><br><span class="line">set security policies from-zone untrust to-zone trust policy B-A then log session-close</span><br><span class="line">4.开ARP代理，因为10.5.5.5 和172.16.1.1是实际上不存在的，所以需要在物理接口上开ARP代理</span><br><span class="line">set security nat proxy-arp interface reth0.0 address 10.5.5.5/32 to 10.5.5.5/32  </span><br><span class="line">set security nat proxy-arp interface reth1.0 address 172.16.1.1/32 to 172.16.1.1/32</span><br><span class="line">注：reth0.0位内部接口，reth1.0为防火墙外部接口</span><br></pre></td></tr></table></figure><h2 id="策略路由"><a href="#策略路由" class="headerlink" title="策略路由"></a>策略路由</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">静态路由/默认路由</span><br><span class="line">set routing-options static route 0.0.0.0/0 next-hop 10.1.1.2</span><br><span class="line">如果是双链路或者多链路，可以使用以下方式配置，然后在配置rpm监测，如果不配置rpm将不会自动切换</span><br><span class="line">静态路由默认优先级值为5，可使用preference来手动指定</span><br><span class="line">set routing-options static route 0.0.0.0/0 next-hop 10.1.1.2</span><br><span class="line">set routing-options static route 0.0.0.0/0 qualified-next-hop 20.1.1.2 preference 20</span><br><span class="line"></span><br><span class="line">策略路由(多出口示例)</span><br><span class="line">配置思路：</span><br><span class="line">1. 创建独立于主路由表inet.0的路由表即routing-instance路由实例</span><br><span class="line">  2. 为这些实例添加路由表</span><br><span class="line">  3. 为路由条目添加底层路由</span><br><span class="line">  4. 根据源地址配置过滤策略(即ACL)，并将这些数据送进不同的路由表</span><br><span class="line">  5. 将过滤策略应用在内网接口的input方向</span><br><span class="line">  </span><br><span class="line">1. 创建路由实例，名称为PBRCU,PBRCT,分别对应联通和移动线路</span><br><span class="line">set routing-instances pbrct instance-type forwarding \\类型为forwarding </span><br><span class="line">set routing-instances pbrct routing-options static route 0.0.0.0/0 next-hop 20.1.1.1 \\路由条目</span><br><span class="line">set routing-instances pbrcu instance-type forwarding</span><br><span class="line">set routing-instances pbrcu routing-options static route 0.0.0.0/0 next-hop 10.1.1.1</span><br><span class="line"></span><br><span class="line">2. 创建rib-group并关联新创建的实例及默认inet.0路由，同时将直连路由安装进实例路由表</span><br><span class="line">set routing-options rib-groups pbr-group import-rib inet.0 \\关联inet.0路由</span><br><span class="line">set routing-options rib-groups pbr-group import-rib pbrcu.inet.0 \\关联新建的路由实例pbrcu.inet.0</span><br><span class="line">set routing-options rib-groups pbr-group import-rib pbrct.inet.0 \\关联新建的路由实例pbrct.inet.0</span><br><span class="line">set routing-options interface-routes rib-group inet pbr-group\\安装直连路由至rib-group组</span><br><span class="line"></span><br><span class="line">3. 配置过滤条件(可以理解为我们常用的ACL)</span><br><span class="line">set firewall filter pbracl term aclid1 from address 192.168.1.0/24 \\匹配源地址</span><br><span class="line">set firewall filter pbracl term aclid1 then log \\开启log日志</span><br><span class="line">set firewall filter pbracl term aclid1 then routing-instance pbrct \\如果满足条件，则执行路由实例pbrct</span><br><span class="line">set firewall filter pbracl term default then accept \\其他则默认走主路由表</span><br><span class="line"></span><br><span class="line">4. 将filter关联在接口input方向</span><br><span class="line">set interfaces ge-0/0/2 unit 0 family inet filter input pbracl</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> juniper </tag>
            
            <tag> 防火墙 </tag>
            
            <tag> SRX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Firepower 2100升级</title>
      <link href="/posts/a6d38682.html"/>
      <url>/posts/a6d38682.html</url>
      
        <content type="html"><![CDATA[<h2 id="fxos模式"><a href="#fxos模式" class="headerlink" title="fxos模式"></a>fxos模式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">由于firepower防火墙在单独运行ASA的时候，是运行在fxos系统中的一台虚拟机，故升级模式和平时不太一样</span><br><span class="line">show chassis inv </span><br><span class="line">show package</span><br><span class="line">进入fxos模式</span><br><span class="line">scope firmware</span><br><span class="line">download image ftp://username@1.1.1.1/image_name </span><br><span class="line">show download-task</span><br><span class="line">state 状态为downloding时表示正在传输</span><br><span class="line">state为downloaded时表示传输完成</span><br><span class="line">show package</span><br><span class="line">scope auto-install </span><br><span class="line">install security-pack version 9.18.2</span><br><span class="line">通过show或者show detail查看安装状态，安装完成后系统会自动重启</span><br><span class="line">重启完成后，可以正常登录fxos系统，但是此时ASA还需要进行升级但都是自动的，持续等待即可</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此次升级会同时升级fxos和asa两个平台</p><p>使用 FXOS CLI 升级独立设备(官方参考链接)<br><a href="https://www.cisco.com/c/zh_cn/td/docs/security/asa/upgrade/asa-upgrade.pdf">官方参考</a></p>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> Firepower </tag>
            
            <tag> ASA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>asa sslvpn配置</title>
      <link href="/posts/5e66de32.html"/>
      <url>/posts/5e66de32.html</url>
      
        <content type="html"><![CDATA[<h2 id="本地用户配置"><a href="#本地用户配置" class="headerlink" title="本地用户配置"></a>本地用户配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">** 本地用户配置**</span><br><span class="line"></span><br><span class="line">基本配置不在赘述，只讲VPN相关配置，(本地用户密码认证)</span><br><span class="line">sslvpn用户DHCP</span><br><span class="line">ip local pool SslVpnUser 192.168.1.1-192.168.1.100 mask 255.255.255.0</span><br><span class="line">nat免除</span><br><span class="line">nat (inside,outside) source static obj_network obj_network destination static sslsub sslsub</span><br><span class="line">acl配置</span><br><span class="line">access-list sslacl extended permit tcp object sslsub object obj_30.2.2.0 \\源为vpn用户，目的为内网网段</span><br><span class="line">  access-list sslacl2 standard permit host 172.17.1.254 \\标准acl，只写目的</span><br><span class="line">  注意： 此处的两种类型ACL在下方根据场景选择性调用，可以调用同一个ACL</span><br><span class="line">webvpn配置</span><br><span class="line">webvpn</span><br><span class="line">  port 10443 \\定义访问端口</span><br><span class="line"> enable outside \\在公网接口启用webvpn功能</span><br><span class="line"> anyconnect image disk0:/anyconnect-win-4.9.04053-webdeploy-k9.pkg \\客户端文件</span><br><span class="line"> anyconnect enable \\开启anyconnect访问</span><br><span class="line"> tunnel-group-list enable \\开启隧道组选择选项</span><br><span class="line">组策略配置</span><br><span class="line">group-policy sslGp internal</span><br><span class="line">group-policy sslGp attributes</span><br><span class="line">  vpn-filter value sslacl \\调用acl配置</span><br><span class="line"> vpn-tunnel-protocol ssl-client  \\定义vpn隧道协议</span><br><span class="line"> split-tunnel-policy tunnelspecified *\\vpn走远端和网络走本地,此配置需要和split-tunnel-network-list配合使用</span><br><span class="line">    split-tunnel-network-list sslacl2 *\\</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"> split-tunnel-policy tunnelall *\\流量全部走远端</span><br><span class="line">    </span><br><span class="line">    此处加*的配置，是根据场景选配的，请注意，而且调用ACL不是同一个，acl分别为标准ACL和扩展ACL，</span><br><span class="line">    为了使VPN用户访问内网资源时可以限制到端口级</span><br><span class="line">    </span><br><span class="line">隧道组配置</span><br><span class="line">tunnel-group sslTg type remote-access \\隧道组类型</span><br><span class="line">tunnel-group sslTg general-attributes</span><br><span class="line"> address-pool SslVpnUser \\调用DHCP配置</span><br><span class="line"> default-group-policy sslGp \\调用组策略配置</span><br><span class="line">tunnel-group sslTg webvpn-attributes</span><br><span class="line"> group-alias ssltest enable\\隧道别名 --即客户端连接时显示的资源名称</span><br><span class="line">用户配置</span><br><span class="line">username user1 password cisco123 privilege 0</span><br><span class="line">  username user1 attributes</span><br><span class="line"> group-lock value sslTg \\匹配隧道组</span><br><span class="line"> service-type remote-access \\类型为远程接入</span><br></pre></td></tr></table></figure><h2 id="结合AD域环境配置"><a href="#结合AD域环境配置" class="headerlink" title="结合AD域环境配置"></a>结合AD域环境配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">** LDAP用户登录配置**</span><br><span class="line">基本配置(可参考：本地用户密码认证)不在赘述，只讲VPN相关配置，，其余配置和以上相同保持不变</span><br><span class="line">dc=域名，比如主域名：tt.com ,写成dc就是 dc=tt,dc=com</span><br><span class="line">ou=组织单位</span><br><span class="line">cn=用户名或者文件夹，administrator默认所在的目录就是文件夹即Users</span><br><span class="line"></span><br><span class="line">LDAP服务器配置</span><br><span class="line">aaa-server localAD protocol ldap \\认证服务器使用的协议，localAD=服务器组的名称</span><br><span class="line">  aaa-server localAD (inside) host 172.16.254.122 \\服务器在inside区域，地址为254.122</span><br><span class="line">  timeout 60 \\超时时间</span><br><span class="line">    ldap-base-dn dc=tt,dc=com \\定义用户登录时，搜索用域名的目录</span><br><span class="line"> ldap-scope subtree</span><br><span class="line"> ldap-naming-attribute sAMAccountName \\此项必须要有</span><br><span class="line"> ldap-login-password cisco \\用于登录ad进行连接验证的密码</span><br><span class="line"> ldap-login-dn cn=administrator,cn=users,dc=tt,dc=com \\用户登录ad进行验证的用户名目录</span><br><span class="line">    server-type microsoft \\服务器类型为微软AD，也可以配置成auto-detect,让ASA自动侦测</span><br><span class="line">隧道组配置</span><br><span class="line">tunnel-group sslTg type remote-access \\隧道组类型</span><br><span class="line">tunnel-group sslTg general-attributes</span><br><span class="line"> address-pool SslVpnUser \\调用DHCP配置</span><br><span class="line"> default-group-policy sslGp \\调用组策略配置</span><br><span class="line">    authentication-server-group localAD \\指定认证方式为ad服务器用户</span><br><span class="line">tunnel-group sslTg webvpn-attributes</span><br><span class="line"> group-alias ssltest enable\\隧道别名 --即客户端连接时显示的资源名称</span><br></pre></td></tr></table></figure><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ASA添加lDAP信息，域控用户路径顺序，CN OU DC DC ,即先写小方向的再写大方向的</span><br><span class="line">示例：域控域名为： aaa.idc.com</span><br><span class="line">     cn=用户名 cn=文件夹 ou=子组织单位 ou=主组织单位 dc=子域名 dc=主域名 dc=域名后缀</span><br><span class="line">     cn=user1,cn=itgroup,ou=bjidc,ou=idc,dc=aaa,dc=idc,dc=com</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> cisco ASA </tag>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>asa ipsec配置</title>
      <link href="/posts/dc317ab2.html"/>
      <url>/posts/dc317ab2.html</url>
      
        <content type="html"><![CDATA[<h2 id="ISP配置"><a href="#ISP配置" class="headerlink" title="ISP配置"></a>ISP配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inter g0/0</span><br><span class="line">ip add 1.1.1.1 255.255.255.248</span><br><span class="line">inter g0/1</span><br><span class="line">ip add 2.1.1.1 255.255.255.248</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="AF1配置"><a href="#AF1配置" class="headerlink" title="AF1配置"></a>AF1配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">公网接口配置</span><br><span class="line">inter g0/0</span><br><span class="line">nameif outside</span><br><span class="line">  ip add 1.1.1.1 255.255.255.248</span><br><span class="line">内网接口配置</span><br><span class="line">inter g0/1</span><br><span class="line">nameif inside</span><br><span class="line">  ip add 10.1.1.1 255.255.255.248</span><br><span class="line">内网网络对象配置</span><br><span class="line">object network user_network</span><br><span class="line">  subnet 10.2.1.0 255.255.255.0</span><br><span class="line">nat (inside,outside) dynamic interface //对此网段地址做源地址转换，转换地址为出接口地址</span><br><span class="line">策略配置(ACL)</span><br><span class="line">  access-list InToOut extended permit ip object user_network any</span><br><span class="line">  access-list InToOut extended permit icmp any any</span><br><span class="line">将策略应用在接口</span><br><span class="line">  access-group InToOut in interface outside</span><br><span class="line">路由配置</span><br><span class="line">  route outside 0.0.0.0 0.0.0.0 1.1.1.1</span><br><span class="line">  route inside 10.2.1.0 255.255.255.0 10.1.1.2</span><br><span class="line">  </span><br><span class="line">\\\\\\以上为基本上网配置</span><br><span class="line"></span><br><span class="line">IPSEC配置</span><br><span class="line">1. 配置ISAKMP-IKEV1</span><br><span class="line">   创建IKE策略</span><br><span class="line">    crypto ikev1 policy 10 \\策略值越搞，调用优先级越高</span><br><span class="line">  encryption 3des \\指定加密算法</span><br><span class="line">    authentication pre-share \\指定身份验证方法，此处为预共享密钥</span><br><span class="line">    hash md5 \\指定散列算法 哈希算法双方保持一致，用作签名，确保数据一致性</span><br><span class="line">    group 2 \\ 指定Diffie-Hellman 群标识符</span><br><span class="line">    lifetime 14400 \\指定 SA 寿命</span><br><span class="line"> 2. 创建隧道组</span><br><span class="line">    tunnel-group 2.1.1.2 type ipsec-l2l \\隧道类型为LAN TO LAN</span><br><span class="line">    tunnel-group 2.1.1.2 ipsec-attributes \\配置ipsec属性</span><br><span class="line">    ikev1 pre-shared-key cisco1234</span><br><span class="line"> 3. 配置本地和对端需通讯的内网对象</span><br><span class="line">    object network ipsec-LocalNetwork</span><br><span class="line">    subnet 10.2.1.0 255.255.255.0</span><br><span class="line">    object network ipsec-RemoteNetwork</span><br><span class="line">    subnet 20.2.1.0 255.255.255.0</span><br><span class="line"> 4. 配置ACL，用于匹配ipsec隧道数据流</span><br><span class="line">    access-list ipsec10 extended permit ip ipsec-LocalNetwork ipsec-RemoteNetwork</span><br><span class="line"> 5. 配置ikev1策略(转换集)</span><br><span class="line">    crypto ipsec ikev1 transform-set ESP-AES-SHA esp-aes esp-sha-hmac \\下方加密映射集中调用</span><br><span class="line"> 6. 配置加密映射集</span><br><span class="line">    crypto map 2.1.1.2map 10 match address ipsec10 \\匹配ipsec acl</span><br><span class="line">    crypto map 2.1.1.2map 10 set peer 2.1.1.2 \\配置对端ipsec设备地址</span><br><span class="line">    crypto map 2.1.1.2map 10 set ikev1 transform-set ESP-AES-SHA \\调用ikev1转换集，用来保护流量</span><br><span class="line"> 7. 将加密映射集应用在接口</span><br><span class="line">    crypto map 2.1.1.2map interface outside</span><br><span class="line"> 8. 在接口启用ikev1密钥管理协议</span><br><span class="line">    crypto ikeve1 enable outside</span><br><span class="line"> 9.配置NAT豁免</span><br><span class="line">   nat (inside,outside) source static ipsec-LocalNetwork ipsec-LocalNetwork destination static ipsec-RemoteNetwork ipsec-RemoteNetwork</span><br></pre></td></tr></table></figure><h2 id="SW1配置"><a href="#SW1配置" class="headerlink" title="SW1配置"></a>SW1配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">上联接口配置</span><br><span class="line">int g0/0</span><br><span class="line">  ip add 10.1.1.2 255.255.255.248</span><br><span class="line">本地网络配置</span><br><span class="line">inter lookbacp</span><br><span class="line">  ip add 10.2.1.254 255.255.255.0</span><br><span class="line">上网验证 </span><br><span class="line">ping 1.1.1.1 source 10.2.1.254</span><br><span class="line">  echo !!!!!</span><br></pre></td></tr></table></figure><blockquote><p>此处只展示了AF1的配置，AF2的配置按照相同的方式配置，并修改相应细节即可</p></blockquote><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">debug crypto ipsec 255</span><br><span class="line">debug crypto ikev1 255</span><br><span class="line">ter log</span><br><span class="line">ter mon</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> cisco ASA </tag>
            
            <tag> ipsec </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ASA上网配置</title>
      <link href="/posts/193ea2e.html"/>
      <url>/posts/193ea2e.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>实验拓扑<br><img src="https://img.ksdn.org/i/2024/08/23/66c86c798c3a1.png"></p></blockquote><h2 id="ISP配置"><a href="#ISP配置" class="headerlink" title="ISP配置"></a>ISP配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inter g0/0</span><br><span class="line">ip add 1.1.1.1 255.255.255.248</span><br><span class="line">inter g0/1</span><br><span class="line">ip add 2.1.1.1 255.255.255.248</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="AF1配置"><a href="#AF1配置" class="headerlink" title="AF1配置"></a>AF1配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">公网接口配置</span><br><span class="line">inter g0/0</span><br><span class="line">nameif outside</span><br><span class="line">  ip add 1.1.1.1 255.255.255.248</span><br><span class="line">内网接口配置</span><br><span class="line">inter g0/1</span><br><span class="line">nameif inside</span><br><span class="line">  ip add 10.1.1.1 255.255.255.248</span><br><span class="line">内网网络对象配置</span><br><span class="line">object network user_network</span><br><span class="line">  subnet 10.2.1.0 255.255.255.0</span><br><span class="line">nat (inside,outside) dynamic interface //对此网段地址做源地址转换，转换地址为出接口地址</span><br><span class="line">策略配置(ACL)</span><br><span class="line">access-list InToOut extended permit ip object user_network any</span><br><span class="line">  access-list InToOut extended permit icmp any any</span><br><span class="line">将策略应用在接口</span><br><span class="line">access-group InToOut in interface outside</span><br><span class="line">路由配置</span><br><span class="line">route outside 0.0.0.0 0.0.0.0 1.1.1.1</span><br><span class="line">  route inside 10.2.1.0 255.255.255.0 10.1.1.2</span><br></pre></td></tr></table></figure><h2 id="SW1配置"><a href="#SW1配置" class="headerlink" title="SW1配置"></a>SW1配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">上联接口配置</span><br><span class="line">int g0/0</span><br><span class="line">  ip add 10.1.1.2 255.255.255.248</span><br><span class="line">本地网络配置</span><br><span class="line">inter lookbacp</span><br><span class="line">  ip add 10.2.1.254 255.255.255.0</span><br><span class="line">上网验证 </span><br><span class="line">ping 1.1.1.1 source 10.2.1.254</span><br><span class="line">  echo !!!!!</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>ASA版本： 9.x<br>ISP模拟运营商设备，不能配置回程路由！！！！！！！！</p>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cisco route多出口冗余</title>
      <link href="/posts/1c6475db.html"/>
      <url>/posts/1c6475db.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#其实这个实验根本不需要用到track和IP SLA，只需2条metric不同的静态路由即可。这里我写出来只是想了解下track的用法。</span><br><span class="line">track 2 interface FastEthernet0/0 line-protocol  #这是一种track的写法，能直接检测接口的链路通断状态，我觉得要比结合IP SLA的更简单，但是不如IP SLA控制的精细。</span><br><span class="line"> delay down 5 up 5</span><br><span class="line">!</span><br><span class="line">track 3 rtr 3 reachability  #结合下方的IP SLA 3实现检测下一跳是否可达。</span><br><span class="line"> delay down 5 up 5</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">interface FastEthernet0/0</span><br><span class="line"> ip address 23.0.0.2 255.255.255.0</span><br><span class="line"> ip nat outside</span><br><span class="line"> ip virtual-reassembly</span><br><span class="line"> duplex half</span><br><span class="line">!</span><br><span class="line">interface FastEthernet1/0</span><br><span class="line"> ip address 24.0.0.2 255.255.255.0</span><br><span class="line"> ip nat outside</span><br><span class="line"> ip virtual-reassembly</span><br><span class="line"> duplex auto</span><br><span class="line"> speed auto</span><br><span class="line">!</span><br><span class="line">interface FastEthernet1/1</span><br><span class="line"> ip address 12.0.0.1 255.255.255.0</span><br><span class="line"> ip nat inside</span><br><span class="line"> ip virtual-reassembly</span><br><span class="line"> duplex auto</span><br><span class="line"> speed auto</span><br><span class="line">!</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 24.0.0.1 3  #实现线路故障后，自动切换。只需2条metric不同的静态路由就能实现。很简单！难点是route-map结合NAT部分。</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 23.0.0.1 2  #默认走这条线路</span><br><span class="line">#其实，这里不给这2条静态路由指定metric也可以，只不过那样就不好控制流量的走向了。流量默认有可能走电信，也有可能走联通。</span><br><span class="line">ip route 192.168.0.0 255.255.0.0 FastEthernet1/1</span><br><span class="line">no ip http server</span><br><span class="line">no ip http secure-server</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">#知识点1：多条nat语句时，从上到下顺序执行，匹配成功后，后面的不在执行。</span><br><span class="line">ip nat inside source route-map PBR-DX interface FastEthernet0/0 overload   </span><br><span class="line">ip nat inside source route-map PBR-LT interface FastEthernet1/0 overload</span><br><span class="line"> #难点配置！！！我想了好半天才明白，如何实现线路切换时，NAT还能正常解析。</span><br><span class="line">#因为如果是动态切换，所以每个出接口都得配置nat，而直接用access-list匹配流量是无法做到的，因为用ACL匹配流量，只能写一条ip nat inside source...语句，也就是说只能在一个出接口执行NAT。</span><br><span class="line">!</span><br><span class="line">ip sla 3</span><br><span class="line"> icmp-echo 24.0.0.1 source-interface FastEthernet1/0</span><br><span class="line"> frequency 5</span><br><span class="line">ip sla schedule 3 life forever start-time now</span><br><span class="line">logging alarm informational</span><br><span class="line">access-list 90 permit any  #因为大部分公司，所有流量都是需要做nat的，因此这里直接匹配所有。</span><br><span class="line">no cdp log mismatch duplex</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">route-map PBR-DX permit 10    #难点配置2！！！</span><br><span class="line"> match ip address 90</span><br><span class="line"> match interface FastEthernet0/0  </span><br><span class="line">!</span><br><span class="line">route-map PBR-LT permit 10</span><br><span class="line"> match ip address 90</span><br><span class="line"> match interface FastEthernet1/0  </span><br><span class="line">#第一条match语句和上面的一样，最主要的就是第二条语句。</span><br><span class="line">#我看网上很多人这里写的是set interface f1/0，我觉得那样写是不对的。</span><br><span class="line">#因为这里的route-map的工作仅仅是匹配流量即可，无需做出什么动作。所以不应该出现set语句。</span><br><span class="line">#至于match interface f1/0的含义，可以参考IOS说明：</span><br><span class="line"># interface -- Match first hop interface of route</span><br><span class="line">#我的理解是：根据路由的下一跳来匹配流量，因为这里要实现双ISP互备，所以默认静态路由会变，</span><br><span class="line">#路由把流量导向哪个接口，我就用那个接口的IP地址做NAT。（比较拗口，结合图多想想就理解了。）</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> 思科 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cisco catalyst 9500堆叠配置</title>
      <link href="/posts/20940d9c.html"/>
      <url>/posts/20940d9c.html</url>
      
        <content type="html"><![CDATA[<h2 id="开启stackwise-virtual-功能，并配置机框编号"><a href="#开启stackwise-virtual-功能，并配置机框编号" class="headerlink" title="开启stackwise virtual 功能，并配置机框编号"></a>开启stackwise virtual 功能，并配置机框编号</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; enable \\进入全局模式</span><br><span class="line"># switch 1 renumber 2 \\配置机框编号为2</span><br><span class="line"># switch 1 priority 5 \\配置优先级，可选值为1-15</span><br><span class="line"># configure terminal \\进入全局配置模式</span><br><span class="line">(config)# stackwise-virtual </span><br><span class="line">(config-stackwise-virtual)# domain 2</span><br><span class="line"># write memory </span><br><span class="line"># reload \\保存配置并重启</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置stackwise-virtual-链路"><a href="#配置stackwise-virtual-链路" class="headerlink" title="配置stackwise virtual 链路"></a>配置stackwise virtual 链路</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">配置模式下进入端口视图</span><br><span class="line">#(config) int ten1/0/2</span><br><span class="line">#(config-if) stackwise-virtual link 1</span><br><span class="line"># write memory </span><br><span class="line"># reload \\保存配置并重启</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置双活DAD-Dual-Actice-Detection-检测"><a href="#配置双活DAD-Dual-Actice-Detection-检测" class="headerlink" title="配置双活DAD(Dual-Actice-Detection)检测"></a>配置双活DAD(Dual-Actice-Detection)检测</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">使用一个业务口，光口或者电口均可</span><br><span class="line">配置模式下进入端口视图，</span><br><span class="line">#(config) int g1/0/48</span><br><span class="line">#(config-if) stackwise-virtual dual-active-detection</span><br><span class="line"># write memory </span><br><span class="line"># reload \\保存配置并重启</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="验证Stackwise虚拟配置"><a href="#验证Stackwise虚拟配置" class="headerlink" title="验证Stackwise虚拟配置"></a>验证Stackwise虚拟配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">显示 stackwise 虚拟连接信息</span><br><span class="line">show stackwise-virtual link</span><br><span class="line"></span><br><span class="line">显示双活检测信息</span><br><span class="line">show stackwise-virtual dual-active-detection</span><br><span class="line"></span><br><span class="line">显示堆叠虚拟带宽</span><br><span class="line">show staciwise-virtual bandwidth</span><br><span class="line"></span><br><span class="line">显示堆叠虚拟邻居</span><br><span class="line">show stackwise-virtual neighbors</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">显示虚拟堆叠双活主动检测Pagp</span><br><span class="line">show stackwise-virtual dual-active-detection pagp</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cisco ASA SSLVPN 可信证书配置</title>
      <link href="/posts/292aefc4.html"/>
      <url>/posts/292aefc4.html</url>
      
        <content type="html"><![CDATA[<h2 id="创建trustpoint"><a href="#创建trustpoint" class="headerlink" title="创建trustpoint"></a>创建trustpoint</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fqdn = 证书绑定的域名</span><br><span class="line">subject-name = 证书绑定的域名</span><br><span class="line">enrollment terminal</span><br><span class="line">无需配置keypair</span><br><span class="line">示例命令： </span><br><span class="line">crypto ca trustpoint vpn_point</span><br><span class="line">    enrollment terminal</span><br><span class="line">    fqdn vpn.xx.com</span><br><span class="line">    subject-name vpn.xx.com</span><br><span class="line">    no ca-check</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="证书导入"><a href="#证书导入" class="headerlink" title="证书导入"></a>证书导入</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">示例命令：</span><br><span class="line">crypto ca import vpn_point pkcs12 ebe111</span><br><span class="line">Enter the base 64 encoded pkcs12. //此处提示需要导入由base64编码的证书文件</span><br><span class="line">-----BEGIN PKCS12-----</span><br><span class="line"> #证书内容</span><br><span class="line">-----END PKCS12-----</span><br><span class="line">quit</span><br><span class="line">WARNING: CA certificates can be used to validate VPN connections,</span><br><span class="line">by default.  Please adjust the validation-usage of this</span><br><span class="line">trustpoint to limit the validation scope, if necessary.</span><br><span class="line">INFO: Import PKCS12 operation completed successfully.</span><br><span class="line"></span><br><span class="line"># 其中 vpn_point 为刚创建的trustpoint名称</span><br><span class="line"># pkcs12 指导入的证书格式</span><br><span class="line"># ebe111 为证书秘钥(私钥)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="证书制作-pfx类型"><a href="#证书制作-pfx类型" class="headerlink" title="证书制作(pfx类型)"></a>证书制作(pfx类型)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">公网证书包含pfx或pcks12类型证书</span><br><span class="line">base64编码证书转换</span><br><span class="line">我们使用pfx证书进行转换，转换工具：openssl</span><br><span class="line">openssl base64 -in certificate.pfx &gt; ca.base64 #后缀名无所谓</span><br><span class="line">转换完成后，ca.base64还不能正常使用，需要用文本工具打开，在首位分别添加以下标识</span><br><span class="line">-----BEGIN PKCS12-----</span><br><span class="line"> #证书内容</span><br><span class="line">-----END PKCS12-----</span><br><span class="line">2.2 证书制作(非pfx)</span><br><span class="line">公网证书不包含pfx或pcks12证书</span><br><span class="line">可在线搜索或使用命令合成</span><br><span class="line">在线地址：https://www.myssl.cn/tools/merge-pfx-cert.html</span><br><span class="line">合成命令：openssl pkcs12 -export -out server.pfx -inkey server.key -in server.crt </span><br><span class="line"># 输出文件名称：server.pfx</span><br><span class="line"># 证书私钥文件名称：server.key</span><br><span class="line"># 证书文件名称：server.crt</span><br><span class="line"># 因为各大证书机构办法的证书格式差异，此处对文件做了详细解释，但是肯定会包含证书文件，私钥文件</span><br><span class="line"># 得到pfx格式证书后，在返回base64编码证书的制作即可</span><br></pre></td></tr></table></figure><h3 id="证书格式详解"><a href="#证书格式详解" class="headerlink" title="证书格式详解"></a>证书格式详解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private.pem</span><br><span class="line"># 证书私钥，可更改后缀为key。如果使用的是自己上传的CSR文件，将不包含改文件。</span><br><span class="line">fullchain.crt</span><br><span class="line"># 完整的证书链，可更改后缀为pem。文件里一般有两段证书(也会有三张)，一张是你的域名证书，另一张是所依赖的证    书链(可能会有两张证书链)。</span><br><span class="line"></span><br><span class="line">certificate.pfx</span><br><span class="line"># PFX类型证书，一般IIS和Tomcat使用，秘钥在detail.txt中。当然，你也可以根据上面的两个文件自行生成PFX    格式的证书。</span><br><span class="line">certificate.crt</span><br><span class="line"># 域名证书，里面内容同时存在于fullchain.crt文件中</span><br><span class="line">chain.crt</span><br><span class="line"># 依赖的证书链，里面内容同时存在于fullchain.crt文件中</span><br><span class="line">chain_old.crt</span><br><span class="line"># 旧版的证书链，虽然已经到期，但是可以兼容古老的设备(见于letsencrypt)。</span><br></pre></td></tr></table></figure><h3 id="配置证书ssl-接口可信"><a href="#配置证书ssl-接口可信" class="headerlink" title="配置证书ssl 接口可信"></a>配置证书ssl 接口可信</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssl trust-point ASDM_TrustPoint1 outside</span><br><span class="line"># point名称：ASDM_TrustPoint1</span><br><span class="line"># 在哪个端口调用： outside</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cisco </tag>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ocserv vpn服务器搭建</title>
      <link href="/posts/fe236a7a.html"/>
      <url>/posts/fe236a7a.html</url>
      
        <content type="html"><![CDATA[<h2 id="更新数据源"><a href="#更新数据源" class="headerlink" title="更新数据源"></a>更新数据源</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="安装ocserv服务端"><a href="#安装ocserv服务端" class="headerlink" title="安装ocserv服务端"></a>安装ocserv服务端</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ocserv</span><br></pre></td></tr></table></figure><h2 id="开启数据转发"><a href="#开启数据转发" class="headerlink" title="开启数据转发"></a>开启数据转发</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">编辑sysctl.conf,取消 net.ipv4.ip_forward=1的注释，并重新加载sysctl.conf文件</span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"># 保存文件并退出</span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">配置iptable nat</span><br><span class="line">iptables -t nat -A POSTROUTING -j MASQUERADE</span><br><span class="line"># 如果报错请先安装iptable,安装命令如下</span><br><span class="line">apt-get install iptable</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置本地用户认证"><a href="#配置本地用户认证" class="headerlink" title="配置本地用户认证"></a>配置本地用户认证</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 新建用户名存储文件，本地用户认证会读取此文件中的内容</span><br><span class="line">cd /etc/ocserv</span><br><span class="line">touch ocpasswd</span><br><span class="line"># 修改ocserv配置文件，认证方式为本地认证，读取文件为ocpasswd</span><br><span class="line">vim /etc/ocserv/ocserv.conf</span><br><span class="line">auth = &quot;plain[passwd=/etc/ocserv/ocpasswd]&quot;</span><br><span class="line"># 重启ocserv</span><br><span class="line">systemctl restart ocserv</span><br><span class="line"># 将ocserv配置为开机启动</span><br><span class="line">systemctl enable ocserv</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置数据分流或全局代理"><a href="#配置数据分流或全局代理" class="headerlink" title="配置数据分流或全局代理"></a>配置数据分流或全局代理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"># 修改ocserv.conf配置文件</span><br><span class="line"># 修改端口</span><br><span class="line">tcp-port = 443 // 默认为443</span><br><span class="line">udp-port = 443 // 默认为443</span><br><span class="line"># 修改用户连接后获取的IP地址段</span><br><span class="line">ipv4-network = 192.168.1.0 //默认配置，可自定义</span><br><span class="line">ipv4-netmask = 255.255.255.0 //默认配置，可自定义</span><br><span class="line"># 配置分流IP段，no-route:表示不走VPN的网段，route: 表示走VPN的网段</span><br><span class="line"># 此处我配置为大陆网段走本地，其他走VPN，地址段统计时间为2022-05-20</span><br><span class="line">no-route = 1.64.0.0/11</span><br><span class="line">no-route = 1.112.0.0/13</span><br><span class="line">no-route = 1.176.0.0/12</span><br><span class="line">no-route = 1.192.0.0/12</span><br><span class="line">no-route = 14.0.0.0/11</span><br><span class="line">no-route = 14.96.0.0/11</span><br><span class="line">no-route = 14.128.0.0/11</span><br><span class="line">no-route = 14.192.0.0/11</span><br><span class="line">no-route = 27.0.0.0/10</span><br><span class="line">no-route = 27.96.0.0/11</span><br><span class="line">no-route = 27.128.0.0/11</span><br><span class="line">no-route = 27.176.0.0/12</span><br><span class="line">no-route = 27.192.0.0/11</span><br><span class="line">no-route = 27.224.0.0/14</span><br><span class="line">no-route = 36.0.0.0/10</span><br><span class="line">no-route = 36.96.0.0/11</span><br><span class="line">no-route = 36.128.0.0/10</span><br><span class="line">no-route = 36.192.0.0/11</span><br><span class="line">no-route = 36.240.0.0/12</span><br><span class="line">no-route = 39.0.0.0/16</span><br><span class="line">no-route = 39.64.0.0/11</span><br><span class="line">no-route = 39.96.0.0/12</span><br><span class="line">no-route = 39.128.0.0/10</span><br><span class="line">no-route = 40.72.0.0/15</span><br><span class="line">no-route = 40.124.0.0/14</span><br><span class="line">no-route = 42.0.0.0/13</span><br><span class="line">no-route = 42.48.0.0/12</span><br><span class="line">no-route = 42.80.0.0/12</span><br><span class="line">no-route = 42.96.0.0/11</span><br><span class="line">no-route = 42.128.0.0/9</span><br><span class="line">no-route = 43.224.0.0/11</span><br><span class="line">no-route = 45.65.16.0/20</span><br><span class="line">no-route = 45.112.0.0/12</span><br><span class="line">no-route = 45.248.0.0/13</span><br><span class="line">no-route = 47.92.0.0/14</span><br><span class="line">no-route = 47.96.0.0/11</span><br><span class="line">no-route = 49.0.0.0/9</span><br><span class="line">no-route = 49.128.0.0/11</span><br><span class="line">no-route = 49.192.0.0/10</span><br><span class="line">no-route = 52.80.0.0/14</span><br><span class="line">no-route = 54.222.0.0/15</span><br><span class="line">no-route = 58.0.0.0/9</span><br><span class="line">no-route = 58.128.0.0/11</span><br><span class="line">no-route = 58.192.0.0/11</span><br><span class="line">no-route = 58.240.0.0/12</span><br><span class="line">no-route = 59.32.0.0/11</span><br><span class="line">no-route = 59.64.0.0/11</span><br><span class="line">no-route = 59.96.0.0/12</span><br><span class="line">no-route = 59.144.0.0/12</span><br><span class="line">no-route = 59.160.0.0/11</span><br><span class="line">no-route = 59.192.0.0/10</span><br><span class="line">no-route = 60.0.0.0/11</span><br><span class="line">no-route = 60.48.0.0/12</span><br><span class="line">no-route = 60.160.0.0/11</span><br><span class="line">no-route = 60.192.0.0/10</span><br><span class="line">no-route = 61.0.0.0/10</span><br><span class="line">no-route = 61.80.0.0/13</span><br><span class="line">no-route = 61.128.0.0/10</span><br><span class="line">no-route = 61.224.0.0/11</span><br><span class="line">no-route = 91.234.36.0/24</span><br><span class="line">no-route = 101.0.0.0/9</span><br><span class="line">no-route = 101.128.0.0/11</span><br><span class="line">no-route = 101.192.0.0/12</span><br><span class="line">no-route = 101.224.0.0/11</span><br><span class="line">no-route = 106.0.0.0/9</span><br><span class="line">no-route = 106.224.0.0/12</span><br><span class="line">no-route = 110.0.0.0/9</span><br><span class="line">no-route = 110.144.0.0/12</span><br><span class="line">no-route = 110.160.0.0/11</span><br><span class="line">no-route = 110.192.0.0/10</span><br><span class="line">no-route = 111.0.0.0/10</span><br><span class="line">no-route = 111.64.0.0/11</span><br><span class="line">no-route = 111.112.0.0/12</span><br><span class="line">no-route = 111.128.0.0/10</span><br><span class="line">no-route = 111.192.0.0/11</span><br><span class="line">no-route = 111.224.0.0/12</span><br><span class="line">no-route = 112.0.0.0/9</span><br><span class="line">no-route = 112.128.0.0/12</span><br><span class="line">no-route = 112.192.0.0/14</span><br><span class="line">no-route = 112.224.0.0/11</span><br><span class="line">no-route = 113.0.0.0/9</span><br><span class="line">no-route = 113.128.0.0/12</span><br><span class="line">no-route = 113.192.0.0/10</span><br><span class="line">no-route = 114.16.0.0/12</span><br><span class="line">no-route = 114.48.0.0/12</span><br><span class="line">no-route = 114.64.0.0/10</span><br><span class="line">no-route = 114.128.0.0/12</span><br><span class="line">no-route = 114.192.0.0/10</span><br><span class="line">no-route = 115.0.0.0/8</span><br><span class="line">no-route = 116.0.0.0/8</span><br><span class="line">no-route = 117.128.0.0/10</span><br><span class="line">no-route = 118.16.0.0/12</span><br><span class="line">no-route = 118.64.0.0/10</span><br><span class="line">no-route = 118.128.0.0/9</span><br><span class="line">no-route = 119.0.0.0/9</span><br><span class="line">no-route = 119.128.0.0/10</span><br><span class="line">no-route = 119.224.0.0/11</span><br><span class="line">no-route = 120.0.0.0/10</span><br><span class="line">no-route = 120.64.0.0/11</span><br><span class="line">no-route = 120.128.0.0/12</span><br><span class="line">no-route = 120.192.0.0/10</span><br><span class="line">no-route = 121.0.0.0/9</span><br><span class="line">no-route = 121.192.0.0/10</span><br><span class="line">no-route = 122.0.0.0/7</span><br><span class="line">no-route = 124.0.0.0/8</span><br><span class="line">no-route = 125.0.0.0/9</span><br><span class="line">no-route = 125.160.0.0/11</span><br><span class="line">no-route = 125.192.0.0/10</span><br><span class="line">no-route = 137.59.59.0/24</span><br><span class="line">no-route = 137.59.88.0/22</span><br><span class="line">no-route = 139.0.0.0/11</span><br><span class="line">no-route = 139.128.0.0/9</span><br><span class="line">no-route = 140.64.0.0/12</span><br><span class="line">no-route = 140.128.0.0/12</span><br><span class="line">no-route = 140.192.0.0/10</span><br><span class="line">no-route = 144.0.0.0/13</span><br><span class="line">no-route = 144.12.0.0/16</span><br><span class="line">no-route = 144.48.0.0/13</span><br><span class="line">no-route = 144.123.0.0/16</span><br><span class="line">no-route = 144.255.0.0/16</span><br><span class="line">no-route = 146.196.0.0/17</span><br><span class="line">no-route = 150.0.0.0/16</span><br><span class="line">no-route = 150.96.0.0/11</span><br><span class="line">no-route = 150.128.0.0/12</span><br><span class="line">no-route = 150.192.0.0/10</span><br><span class="line">no-route = 152.104.128.0/17</span><br><span class="line">no-route = 153.0.0.0/10</span><br><span class="line">no-route = 153.96.0.0/11</span><br><span class="line">no-route = 157.0.0.0/16</span><br><span class="line">no-route = 157.18.0.0/16</span><br><span class="line">no-route = 157.61.0.0/16</span><br><span class="line">no-route = 157.112.0.0/12</span><br><span class="line">no-route = 157.144.0.0/12</span><br><span class="line">no-route = 157.255.0.0/16</span><br><span class="line">no-route = 159.226.0.0/16</span><br><span class="line">no-route = 160.19.0.0/16</span><br><span class="line">no-route = 160.20.48.0/22</span><br><span class="line">no-route = 160.202.0.0/16</span><br><span class="line">no-route = 160.238.64.0/22</span><br><span class="line">no-route = 161.207.0.0/16</span><br><span class="line">no-route = 162.105.0.0/16</span><br><span class="line">no-route = 163.0.0.0/10</span><br><span class="line">no-route = 163.96.0.0/11</span><br><span class="line">no-route = 163.128.0.0/10</span><br><span class="line">no-route = 163.192.0.0/11</span><br><span class="line">no-route = 164.52.0.0/17</span><br><span class="line">no-route = 166.111.0.0/16</span><br><span class="line">no-route = 167.139.0.0/16</span><br><span class="line">no-route = 167.189.0.0/16</span><br><span class="line">no-route = 167.220.244.0/22</span><br><span class="line">no-route = 168.160.0.0/16</span><br><span class="line">no-route = 170.179.0.0/16</span><br><span class="line">no-route = 171.0.0.0/9</span><br><span class="line">no-route = 171.192.0.0/11</span><br><span class="line">no-route = 175.0.0.0/9</span><br><span class="line">no-route = 175.128.0.0/10</span><br><span class="line">no-route = 180.64.0.0/10</span><br><span class="line">no-route = 180.128.0.0/9</span><br><span class="line">no-route = 182.0.0.0/8</span><br><span class="line">no-route = 183.0.0.0/10</span><br><span class="line">no-route = 183.64.0.0/11</span><br><span class="line">no-route = 183.128.0.0/9</span><br><span class="line">no-route = 192.124.154.0/24</span><br><span class="line">no-route = 192.140.128.0/17</span><br><span class="line">no-route = 195.78.82.0/23</span><br><span class="line">no-route = 202.0.0.0/9</span><br><span class="line">no-route = 202.128.0.0/10</span><br><span class="line">no-route = 202.192.0.0/11</span><br><span class="line">no-route = 203.0.0.0/8</span><br><span class="line">no-route = 210.0.0.0/10</span><br><span class="line">no-route = 210.64.0.0/11</span><br><span class="line">no-route = 210.160.0.0/11</span><br><span class="line">no-route = 210.192.0.0/11</span><br><span class="line">no-route = 211.64.0.0/13</span><br><span class="line">no-route = 211.80.0.0/12</span><br><span class="line">no-route = 211.96.0.0/13</span><br><span class="line">no-route = 211.136.0.0/13</span><br><span class="line">no-route = 211.144.0.0/12</span><br><span class="line">no-route = 211.160.0.0/13</span><br><span class="line">no-route = 216.250.108.0/22</span><br><span class="line">no-route = 218.0.0.0/9</span><br><span class="line">no-route = 218.160.0.0/11</span><br><span class="line">no-route = 218.192.0.0/10</span><br><span class="line">no-route = 219.64.0.0/11</span><br><span class="line">no-route = 219.128.0.0/11</span><br><span class="line">no-route = 219.192.0.0/10</span><br><span class="line">no-route = 220.96.0.0/11</span><br><span class="line">no-route = 220.128.0.0/9</span><br><span class="line">no-route = 221.0.0.0/11</span><br><span class="line">no-route = 221.96.0.0/11</span><br><span class="line">no-route = 221.128.0.0/9</span><br><span class="line">no-route = 222.0.0.0/8</span><br><span class="line">no-route = 223.0.0.0/11</span><br><span class="line">no-route = 223.64.0.0/10</span><br><span class="line">no-route = 223.128.0.0/9</span><br><span class="line"># 保存退出，重启ocserv</span><br></pre></td></tr></table></figure><blockquote><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ocserv.conf 默认包含route内容，如果配置为no-route方式，需更改为以下方式，</span><br><span class="line"># no-route 和 route不能共存，且路由表最多限制200条</span><br><span class="line">no-route = 10.0.0.0/8</span><br><span class="line">no-route = 172.16.0.0/12</span><br><span class="line">no-route = 192.168.1.0/16</span><br><span class="line"></span><br><span class="line"># ocserv.conf 变更后必须重启ocserv服务，不然配置无法生效</span><br><span class="line">systemctl start ocserv //启动ocserv</span><br><span class="line">systemctl restart ocserv //重启ocserv</span><br><span class="line">systemctl status ocserv //查看ocserv状态</span><br><span class="line">systemctl enable ocserv //加入开机启动</span><br><span class="line">systemctl disable ocserv //关闭开机启动</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>debian11设置时间</title>
      <link href="/posts/a9a47dac.html"/>
      <url>/posts/a9a47dac.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>系统版本： Debian 11</p></blockquote><h2 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dpkg-reconfigure tzdata</span><br><span class="line">使用键盘方向键依次选择 Asia/Shanghai</span><br></pre></td></tr></table></figure><h2 id="修改为24小时制"><a href="#修改为24小时制" class="headerlink" title="修改为24小时制"></a>修改为24小时制</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localectl set-locale LC_TIME=en_GB.UTF-8</span><br><span class="line"># 然后重启系统</span><br></pre></td></tr></table></figure><h2 id="查看系统时间"><a href="#查看系统时间" class="headerlink" title="查看系统时间"></a>查看系统时间</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@system:~# date</span><br><span class="line">Fri 27 May 12:12:12 CST 2022</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Debian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FortiGate用Sniffer命令抓包</title>
      <link href="/posts/3be04c34.html"/>
      <url>/posts/3be04c34.html</url>
      
        <content type="html"><![CDATA[<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令: diagnose sniffer packet.</span><br><span class="line"># diag sniffer packet &lt;interface&gt; &lt;&#x27;filter&#x27;&gt; &lt;verbose&gt; &lt;count&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="抓包参数示例"><a href="#抓包参数示例" class="headerlink" title="抓包参数示例"></a>抓包参数示例</h2><h3 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;interface&gt; 指定实际的接口名称，可以是真实的物理接口名称，也可以是</span><br><span class="line">VLAN 的逻辑接口名称，当使用“any”关键字时，表示抓全部接口的数据包。</span><br><span class="line">例：</span><br><span class="line">＃diag sniffer packet port1 //表示抓物理接口为port1 的所有数据包</span><br><span class="line">＃diag sniffer packet any //表示抓所有接口的所有数据包</span><br><span class="line">＃diag sniffer packet port1-v10 //当在物理接口建立一个VLAN 子接口，其逻辑</span><br><span class="line">接口名为port1-v10，此时表示抓port1-v10 接口的所有数据包，此处一定注意一个问题，</span><br><span class="line">由于抓包命令中的空格使用来区分参数字段的，但是在逻辑接口创建时，接口名称支持空</span><br><span class="line">格，考虑到今后抓包分析的方便，建议在创建逻辑接口时不要带有空格。</span><br></pre></td></tr></table></figure><h3 id="verbose"><a href="#verbose" class="headerlink" title="verbose"></a>verbose</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;verbose&gt; 指控制抓取数据包的内容</span><br><span class="line">1: print header of packets, //只抓取IP的原地址、源端口、目的地址、目的端口和数据包</span><br><span class="line">的Sequence numbers 为系统缺省设置</span><br><span class="line">2: print header and data from ip of packets, //抓取IP数据包的详细信息，包括IP数据的</span><br><span class="line">payload。</span><br><span class="line">3: print header and data from ethernet of packets) ，//抓取IP数据包的详细信息，包</span><br><span class="line">括IP数据的payload，导出到文本文件可以使有专用的转换工具，转换为Ethereal支持文件</span><br><span class="line">格式</span><br><span class="line">例：</span><br><span class="line">【例1】 抓所有接口（interface=any）的任何数据包（filter=none），级别1</span><br><span class="line">（verbose＝1）</span><br><span class="line">FG-UTM # dia sni pa any none 1</span><br><span class="line">interfaces=[any]</span><br><span class="line">filters=[none]</span><br><span class="line">nr=2048,fr=1584,b_nr=1024,pg=4096</span><br><span class="line">3.710103 127.0.0.1.1029 -&gt; 127.0.0.1.53: udp 40</span><br><span class="line"></span><br><span class="line">【例2】 抓所有接口（interface=any）的任何数据包（filter=none），级别2</span><br><span class="line">（verbose＝2），会显示数据包的payload信息。</span><br><span class="line"># diag sniffer packet internal none 2 1</span><br><span class="line">192.168.0.1.22 -&gt; 192.168.0.30.1144: psh 2867817048 ack 1951061933</span><br><span class="line">0x0000 4510 005c 8eb1 4000 4006 2a6b c0a8 0001 E..\..@.@.*k....</span><br><span class="line">0x0010 c0a8 001e 0016 0478 aaef 6a58 744a d7ad .......x..jXtJ..</span><br><span class="line">0x0020 5018 0b5c 8ab9 0000 9819 880b f465 62a8 P..\.........eb.</span><br><span class="line">0x0030 3eaf 3804 3fee 2555 8deb 24da dd0d c684 &gt;.8.?.%U..$.....</span><br><span class="line">0x0040 08a9 7907 202d 5898 a85c facb 8c0a f9e5 ..y..-X..\......</span><br><span class="line">0x0050 bd9c b649 5318 7fc5 c415 5a59 ...IS.....ZY</span><br><span class="line"></span><br><span class="line">【例3】 抓所有接口（interface=any）的任何数据包（filter=none），级别3</span><br><span class="line">（verbose＝3），会显示数据包的payload信息。</span><br><span class="line">FG-UTM # dia sni pa any none 3</span><br><span class="line">interfaces=[any]</span><br><span class="line">filters=[none]</span><br><span class="line">nr=2048,fr=1584,b_nr=1024,pg=4096</span><br><span class="line">3.770099 127.0.0.1.1029 -&gt; 127.0.0.1.53: udp 40</span><br><span class="line">0x0000 0004 0304 0000 0000 9200 0000 2a00 0800</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;count&gt; 指使有抓包命令抓取的数据包的数量</span><br><span class="line">例：</span><br><span class="line"># diag sniffer packet internal none 1 3</span><br><span class="line">192.168.0.30.1156 -&gt; 192.168.0.1.80: syn 2164883624</span><br><span class="line">192.168.0.1.80 -&gt; 192.168.0.30.1156: syn 3792179542 ack 2164883625</span><br><span class="line">192.168.0.30.1156 -&gt; 192.168.0.1.80: ack 3792179543</span><br><span class="line">说明：抓取internal 接口，不使有任何过滤器（及none）级别为1，抓取3</span><br><span class="line">个数据包。此处，注意“none”必须要，代表过滤器的类型；注意“1”必须要，</span><br><span class="line">否则系统会自动识别为&lt;verbose&gt;参数。</span><br></pre></td></tr></table></figure><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt; 抓包文件过滤器</span><br><span class="line">语法： &#x27;[[src|dst] host&lt;host_name_or_IP1&gt;] [[src|dst]</span><br><span class="line">host&lt;host_name_or_IP2&gt;] [[arp|ip|gre|esp|udp|tcp] [port_num]]</span><br><span class="line">[[arp|ip|gre|esp|udp|tcp] [port_num]]&#x27;</span><br><span class="line">此处一定注意任何过滤语法必须使用单引号包含，否则会有问题。</span><br><span class="line">第二种简单语法，适用于主机的会话抓包，无源和目的地址之分</span><br><span class="line">&#x27;udp and port 1812 and host client1 and \( client2 or client3 \)&#x27;</span><br><span class="line">【例1】使用源地址和目的地址过滤抓包</span><br><span class="line"># diag sniffer packet internal &#x27;src host 192.168.0.130 and dst</span><br><span class="line">host 192.168.0.1&#x27; 1</span><br><span class="line">192.168.0.130.3426 -&gt; 192.168.0.1.80: syn 1325244087</span><br><span class="line">192.168.0.1.80 -&gt; 192.168.0.130.3426: syn 3483111189 ack 1325244088</span><br><span class="line">192.168.0.130.3426 -&gt; 192.168.0.1.80: ack 3483111190</span><br><span class="line">192.168.0.130.3426 -&gt; 192.168.0.1.80: psh 1325244088 ack 3483111190</span><br><span class="line">192.168.0.1.80 -&gt; 192.168.0.130.3426: ack 1325244686</span><br><span class="line">192.168.0.130.1035 -&gt; 192.168.0.1.53: udp 26</span><br><span class="line">192.168.0.130.1035 -&gt; 192.168.0.1.53: udp 42</span><br><span class="line">192.168.0.130.1035 -&gt; 192.168.0.1.53: udp 42</span><br><span class="line">192.168.0.130 -&gt; 192.168.0.1: icmp: echo request</span><br><span class="line">192.168.0.130.3426 -&gt; 192.168.0.1.80: psh 1325244686 ack 3483111190</span><br><span class="line">192.168.0.1.80 -&gt; 192.168.0.130.3426: ack 1325244735</span><br><span class="line">192.168.0.130 -&gt; 192.168.0.1: icmp: echo request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【例2】使用源地址和目的地址、以及TCP 关键词过滤抓两个地址间的TCP 流</span><br><span class="line">量</span><br><span class="line"># diag sniffer packet internal &#x27;src host 192.168.0.130 and dst host</span><br><span class="line">192.168.0.1 and tcp&#x27; 1</span><br><span class="line">192.168.0.130.3569 -&gt; 192.168.0.1.23: syn 1802541497</span><br><span class="line">192.168.0.1.23 -&gt; 192.168.0.130.3569: syn 4238146022 ack 1802541498</span><br><span class="line">192.168.0.130.3569 -&gt; 192.168.0.1.23: ack 4238146023</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【例3】使用地址（含源地址和目的地址）、以及ICMP 关键词过滤抓某个地</span><br><span class="line">址间的ICMP 流量</span><br><span class="line"># diag sniffer packet internal &#x27;host 192.168.0.130 and icmp&#x27; 1</span><br><span class="line">192.168.0.130 -&gt; 192.168.0.1: icmp: echo request</span><br><span class="line">192.168.0.1 -&gt; 192.168.0.130: icmp: echo reply</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【例4】使用ICMP 关键词抓所有地址间的ICMP 流量</span><br><span class="line">FG-UTM # diagnose sniffer packet port8 &#x27;icmp&#x27;</span><br><span class="line">0.340847 10.7.10.100 -&gt; 10.7.10.1: icmp: echo request</span><br><span class="line">0.340869 10.7.10.1 -&gt; 10.7.10.100: icmp: echo reply</span><br><span class="line">1.340982 10.7.10.100 -&gt; 10.7.10.1: icmp: echo request</span><br><span class="line">1.340997 10.7.10.1 -&gt; 10.7.10.100: icmp: echo reply</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【例5】使用地址（含源地址和目的地址）、以及TCP 的端口关键词过滤抓两</span><br><span class="line">个地址间的TCP 对应端口流量</span><br><span class="line"># diag sniffer packet internal &#x27;host 192.168.0.130 or host 192.168.0.1</span><br><span class="line">and tcp and port 80&#x27; 1</span><br><span class="line">192.168.0.130.3625 -&gt; 192.168.0.1.80: syn 2057246590</span><br><span class="line">192.168.0.1.80 -&gt; 192.168.0.130.3625: syn 3291168205 ack 2057246591</span><br><span class="line">192.168.0.130.3625 -&gt; 192.168.0.1.80: ack 3291168206</span><br><span class="line">192.168.0.130.3625 -&gt; 192.168.0.1.80: psh 2057246591 ack 3291168206</span><br><span class="line">192.168.0.1.80 -&gt; 192.168.0.130.3625: ack 2057247265</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【例6】使用接口、以及TCP 的端口关键词过滤抓多个地址间的TCP 非对应端</span><br><span class="line">口流量，下例为不抓取23 端口的TCP 流量</span><br><span class="line">FG-UTM # diagnose sniffer packet any &#x27;tcp and port !23&#x27;</span><br><span class="line">interfaces=[any]</span><br><span class="line">filters=[tcp and port !23]</span><br><span class="line">nr=8192,fr=1680,b_nr=4096,pg=4096</span><br><span class="line">9.323698 10.7.10.100.1853 -&gt; 10.7.10.1.443: syn 4042810565</span><br><span class="line">9.323786 10.7.10.1.443 -&gt; 10.7.10.100.1853: syn 177080791 ack 4042810566</span><br><span class="line">9.324070 10.7.10.100.1853 -&gt; 10.7.10.1.443: ack 177080792</span><br><span class="line">9.326695 10.7.10.100.1853 -&gt; 10.7.10.1.443: psh 4042810566 ack 177080792</span><br><span class="line">9.326765 10.7.10.1.443 -&gt; 10.7.10.100.1853: ack 4042810644</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【例7】使用接口、以及IP 的协议端口proto 关键词过滤抓多个地址间的IP</span><br><span class="line">层对应端口流量，下例为抓取IP 层协议号为 1 的及ICMP 的流量</span><br><span class="line">FG-UTM # diagnose sniffer packet port8 &#x27;ip proto 1&#x27;</span><br><span class="line">interfaces=[port8]</span><br><span class="line">filters=[ip proto 1]</span><br><span class="line">nr=8192,fr=1664,b_nr=4096,pg=4096</span><br><span class="line">5.701978 10.7.10.100 -&gt; 10.7.10.1: icmp: echo request</span><br><span class="line">5.702056 10.7.10.1 -&gt; 10.7.10.100: icmp: echo reply</span><br><span class="line">6.694490 10.7.10.100 -&gt; 10.7.10.1: icmp: echo request</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 抓包 </tag>
            
            <tag> FortiGate </tag>
            
            <tag> 飞塔防火墙 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iperf3使用教程</title>
      <link href="/posts/b70beb6b.html"/>
      <url>/posts/b70beb6b.html</url>
      
        <content type="html"><![CDATA[<h2 id="iperf下载"><a href="#iperf下载" class="headerlink" title="iperf下载"></a>iperf下载</h2><p><a href="https://iperf.fr/">iperf官网</a><br>点击 Download iPerf binaries ，根据自己的电脑系统安装相应的版本</p><blockquote><p>iperf3 仅支持命令行模式，无gui界面</p></blockquote><h2 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h2><ul><li>windows: cmd切换到iperf安装目录， .&#x2F;iperf3.exe [option]</li><li>mac os : 直接运行命令 iperf [option]</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iperf -s //以服务器模式运行</span><br><span class="line">iperf -c //以客户端模式运行</span><br><span class="line"></span><br><span class="line">iperf -c dst-ip //dst-ip 是指服务器地址</span><br><span class="line"></span><br><span class="line">-i : 指定回显间隔,单位是s; 默认为1s</span><br><span class="line">-d : 指定传输带宽,单位支持m g(M G)</span><br><span class="line">-n : 指定传输文件大小,单位支持 m g(M G)</span><br><span class="line">-u : 测试udp传输带宽</span><br><span class="line">-R : 反向传输，可以理解为服务器和客户端互换角色</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="测试示例"><a href="#测试示例" class="headerlink" title="测试示例"></a>测试示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">服务端ip : 192.168.1.100</span><br><span class="line">客户端ip : 192.168.1.99</span><br><span class="line"></span><br><span class="line">服务端: iperf3 -s</span><br><span class="line"></span><br><span class="line">客户端: iperf3 -c 192.168.1.100 -b 100m -n 1G -i 3</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iperf3 </tag>
            
            <tag> 网络测速 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>snmp测试工具推荐</title>
      <link href="/posts/3749b54c.html"/>
      <url>/posts/3749b54c.html</url>
      
        <content type="html"><![CDATA[<blockquote><blockquote><p>工具推荐：Mib Browser-(gui) 和 snmpwalk-(cli)</p></blockquote></blockquote><h2 id="工具下载"><a href="#工具下载" class="headerlink" title="工具下载"></a>工具下载</h2><h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><p>下载free版感觉就够用了<br>Mib Browser : <a href="https://ireasoning.com/mibbrowser.shtml">https://ireasoning.com/mibbrowser.shtml</a><br><img src="https://ireasoning.com/images/mibscreen.png"><br><img src="https://img.ksdn.org/i/2024/08/21/66c5abbe24acc.png"><br>macos安装软件后, 就自动包含了snmpwalk，可以直接在命令行终端运行 snmpwalk<br><img src="https://img.ksdn.org/i/2024/08/21/66c5abe654a44.png"></p><h3 id="windows-（待补充）"><a href="#windows-（待补充）" class="headerlink" title="windows （待补充）"></a>windows （待补充）</h3><h2 id="使用教程"><a href="#使用教程" class="headerlink" title="使用教程"></a>使用教程</h2><h3 id="GUI界面"><a href="#GUI界面" class="headerlink" title="GUI界面"></a>GUI界面</h3><p>配置snmp客户端ip ，团体名，snmp版本<br>直接遍历所有snmp信息，测试snmp连通性<br><img src="https://img.ksdn.org/i/2024/08/21/66c5aee09cdf3.png"></p><h3 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">snmpwalk -v 1或2c(代表SNMP版本) -c SNMP团体名 IP地址 OID(对象标示符)</span><br><span class="line"></span><br><span class="line">–v：指定snmp的版本, 1或者2，该参数必须有。</span><br><span class="line">–c：指定连接设备SNMP读密码，该参数必须有。</span><br><span class="line">IP：指定要walk的设备的IP地址，该参数必须有。</span><br><span class="line">OID：代表要获取设备的指标oid，该参数不是必须的。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">snmpwalk -v 2c -c public 172.16.1.3 //直接遍历172.16.1.3团体名为public的snmp信息</span><br><span class="line"></span><br><span class="line">snmpwalk -v 2c -c public 172.16.1.3 ifDescr //获取接口信息</span><br><span class="line"></span><br><span class="line">snmpwalk snmpwalk -v 2c -c public 172.16.1.3 OID //获取指定OID信息</span><br><span class="line">比如： snmpwalk snmpwalk -v 2c -c public 172.16.1.3 OID</span><br></pre></td></tr></table></figure><blockquote><p>要获取更多详细信息，需获取设备的MIB文件，通过MIB文件查询相关OID或名称；MIB文件查询设备官网即可</p></blockquote><ul><li><a href="https://support.huawei.com/enterprise/zh/doc/EDOC1000178160/5612b91c">华为MIB文件获取教程</a></li><li><a href="https://www.h3c.com/cn/Products_And_Solution/InterConnect/Products/Comware/ComwareV7/MIB/">华三MIB问价获取教程v7</a></li><li><a href="https://www.h3c.com/cn/Products_And_Solution/InterConnect/Products/Comware/ComwareV5/MIB/">华三MIB问价获取教程v5</a></li><li><a href="https://www.cisco.com/c/zh_cn/support/docs/ip/simple-network-management-protocol-snmp/9226-mibs-9226.html">思科MIB文件获取教程</a></li><li><a href="https://www.juniper.net/documentation/cn/zh/software/junos/network-mgmt/topics/topic-map/snmp-architecture-and-snmp-mibs-overview.html">juniepr MIB获取教程</a></li><li><a href="https://handbook.fortinet.com.cn/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/SNMP/SNMP%E5%85%AC%E5%85%B1MIB%E5%92%8C%E7%A7%81%E6%9C%89MIB.html">飞塔MIB获取教程</a></li><li><a href="https://www.ruijie.com.cn/fw/wd/90354/">锐捷MIB获取教程</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snmp </tag>
            
            <tag> Mib Browser </tag>
            
            <tag> snmpwalk </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
